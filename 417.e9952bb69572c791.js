"use strict";(self.webpackChunkuploader=self.webpackChunkuploader||[]).push([[417],{4417:(Gt,ne,h)=>{h.r(ne),h.d(ne,{MainModule:()=>Qt});var W=h(3271),x=h(6991),d=h(5620),ye=h(61),Ue=h(7462),ve=h(4987),N=h(3287),e=h(5e3);let xe=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main"]],decls:2,vars:0,consts:[[1,"container","mb-5","mt-3"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"router-outlet"),e.qZA())},directives:[N.lC],styles:[""]}),t})();var j=h(5698);const oe=(0,d.PH)("[Upload/UI] attach a file",(0,d.Ky)()),ie=(0,d.PH)("[Upload/UI] Remove all attached files"),Q=(0,d.PH)("[Upload/API] Upload file start",(0,d.Ky)()),R=(0,d.PH)("[Upload/API] Upload file successful",(0,d.Ky)()),re=(0,d.PH)("[Upload/API] Upload file failed",(0,d.Ky)()),G=(0,d.PH)("[Upload/API] Upload file progress update",(0,d.Ky)()),Y=(0,d.PH)("[Upload/API] Update new photo in user DB start",(0,d.Ky)()),se=(0,d.PH)("[Upload/API] Update new photo in user DB successful",(0,d.Ky)()),ae=(0,d.PH)("[Upload/API] Update new photo in user DB failed",(0,d.Ky)()),le="uploadFiles";var f=(()=>{return(t=f||(f={}))[t.EntitiesOnly=0]="EntitiesOnly",t[t.Both=1]="Both",t[t.None=2]="None",f;var t})();function y(t){return function(n,i){const s={ids:[...i.ids],entities:Object.assign({},i.entities)},r=t(n,s);return r===f.Both?Object.assign({},i,s):r===f.EntitiesOnly?Object.assign(Object.assign({},i),{entities:s.entities}):i}}function b(t,o){const n=o(t);return(0,e.X6Q)()&&void 0===n&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",t,"The `selectId` implementation:",o.toString()),n}function ce(t){function o(m,c){const l=b(m,t);return l in c.entities?f.None:(c.ids.push(l),c.entities[l]=m,f.Both)}function n(m,c){let l=!1;for(const a of m)l=o(a,c)!==f.None||l;return l?f.Both:f.None}function s(m,c){const l=b(m,t);return l in c.entities?(c.entities[l]=m,f.EntitiesOnly):(c.ids.push(l),c.entities[l]=m,f.Both)}function U(m,c){const a=(m instanceof Array?m:c.ids.filter(p=>m(c.entities[p]))).filter(p=>p in c.entities).map(p=>delete c.entities[p]).length>0;return a&&(c.ids=c.ids.filter(p=>p in c.entities)),a?f.Both:f.None}function w(m,c){return P([m],c)}function P(m,c){const l={};return(m=m.filter(p=>p.id in c.entities)).length>0?m.filter(g=>function E(m,c,l){const p=Object.assign({},l.entities[c.id],c.changes),g=b(p,t),_=g!==c.id;return _&&(m[c.id]=g,delete l.entities[c.id]),l.entities[g]=p,_}(l,g,c)).length>0?(c.ids=c.ids.map(g=>l[g]||g),f.Both):f.EntitiesOnly:f.None}function S(m,c){const l=[],a=[];for(const _ of m){const v=b(_,t);v in c.entities?a.push({id:v,changes:_}):l.push(_)}const p=P(a,c),g=n(l,c);switch(!0){case g===f.None&&p===f.None:return f.None;case g===f.Both||p===f.Both:return f.Both;default:return f.EntitiesOnly}}return{removeAll:function C(m){return Object.assign({},m,{ids:[],entities:{}})},addOne:y(o),addMany:y(n),setAll:y(function i(m,c){return c.ids=[],c.entities={},n(m,c),f.Both}),setOne:y(s),setMany:y(function r(m,c){const l=m.map(a=>s(a,c));switch(!0){case l.some(a=>a===f.Both):return f.Both;case l.some(a=>a===f.EntitiesOnly):return f.EntitiesOnly;default:return f.None}}),updateOne:y(w),updateMany:y(P),upsertOne:y(function O(m,c){return S([m],c)}),upsertMany:y(S),removeOne:y(function u(m,c){return U([m],c)}),removeMany:y(U),map:y(function L(m,c){return P(c.ids.reduce((p,g)=>{const _=m(c.entities[g]);return _!==c.entities[g]&&p.push({id:g,changes:_}),p},[]).filter(({id:p})=>p in c.entities),c)}),mapOne:y(function k({map:m,id:c},l){const a=l.entities[c];return a?w({id:c,changes:m(a)},l):f.None})}}function de(t={}){var o,n;const{selectId:i,sortComparer:s}={selectId:null!==(o=t.selectId)&&void 0!==o?o:C=>C.id,sortComparer:null!==(n=t.sortComparer)&&void 0!==n&&n},r=function we(){return{getInitialState:function t(o={}){return Object.assign({ids:[],entities:{}},o)}}}(),u=function Se(){return{getSelectors:function t(o){const n=u=>u.ids,i=u=>u.entities,s=(0,d.P1)(n,i,(u,U)=>u.map(C=>U[C])),r=(0,d.P1)(n,u=>u.length);return o?{selectIds:(0,d.P1)(o,n),selectEntities:(0,d.P1)(o,i),selectAll:(0,d.P1)(o,s),selectTotal:(0,d.P1)(o,r)}:{selectIds:n,selectEntities:i,selectAll:s,selectTotal:r}}}}(),U=s?function Ze(t,o){const{removeOne:n,removeMany:i,removeAll:s}=ce(t);function r(l,a){return u([l],a)}function u(l,a){const p=l.filter(g=>!(b(g,t)in a.entities));return 0===p.length?f.None:(c(p,a),f.Both)}function C(l,a){const p=b(l,t);return p in a.entities?(a.ids=a.ids.filter(g=>g!==p),c([l],a),f.Both):r(l,a)}function w(l,a){return L([l],a)}function L(l,a){const p=[],g=l.filter(_=>function P(l,a,p){if(!(a.id in p.entities))return!1;const _=Object.assign({},p.entities[a.id],a.changes),v=b(_,t);return delete p.entities[a.id],l.push(_),v!==a.id}(p,_,a)).length>0;if(0===p.length)return f.None;{const _=a.ids,v=[];return a.ids=a.ids.filter((F,Z)=>F in a.entities||(v.push(Z),!1)),c(p,a),!g&&v.every(F=>a.ids[F]===_[F])?f.EntitiesOnly:f.Both}}function m(l,a){const p=[],g=[];for(const F of l){const Z=b(F,t);Z in a.entities?g.push({id:Z,changes:F}):p.push(F)}const _=L(g,a),v=u(p,a);switch(!0){case v===f.None&&_===f.None:return f.None;case v===f.Both||_===f.Both:return f.Both;default:return f.EntitiesOnly}}function c(l,a){l.sort(o);const p=[];let g=0,_=0;for(;g<l.length&&_<a.ids.length;){const v=l[g],F=b(v,t),Z=a.ids[_];o(v,a.entities[Z])<=0?(p.push(F),g++):(p.push(Z),_++)}a.ids=p.concat(g<l.length?l.slice(g).map(t):a.ids.slice(_)),l.forEach((v,F)=>{a.entities[t(v)]=v})}return{removeOne:n,removeMany:i,removeAll:s,addOne:y(r),updateOne:y(w),upsertOne:y(function S(l,a){return m([l],a)}),setAll:y(function U(l,a){return a.entities={},a.ids=[],u(l,a),f.Both}),setOne:y(C),setMany:y(function E(l,a){const p=l.map(g=>C(g,a));switch(!0){case p.some(g=>g===f.Both):return f.Both;case p.some(g=>g===f.EntitiesOnly):return f.EntitiesOnly;default:return f.None}}),addMany:y(u),updateMany:y(L),upsertMany:y(m),map:y(function k(l,a){return L(a.ids.reduce((g,_)=>{const v=l(a.entities[_]);return v!==a.entities[_]&&g.push({id:_,changes:v}),g},[]),a)}),mapOne:y(function O({map:l,id:a},p){const g=p.entities[a];return g?w({id:a,changes:l(g)},p):f.None})}}(i,s):ce(i);return Object.assign(Object.assign(Object.assign({selectId:i,sortComparer:s},r),u),U)}const T=de({selectId:function De(t){return t.id},sortComparer:function Be(t,o){return t.attachDate&&o.attachDate?t.attachDate<o.attachDate?1:-1:1}}),Ne=T.getInitialState({apiWorking:!1,filesUploadedAndUrlAddedToDb:[],errMsg:void 0,error:!1}),je=(0,d.Lq)(Ne,(0,d.on)(ie,t=>T.removeAll(Object.assign(Object.assign({},t),{apiWorking:!1,error:!1,errMsg:void 0,filesUploadedAndUrlAddedToDb:[]}))),(0,d.on)(Q,(t,{file:o,fileId:n})=>{const i={attachDate:(new Date).getTime(),dateModified:o.lastModified,file:o,fileName:o.name,fileSize:o.size,id:n,completed:!1,progress:0,downloadUrl:void 0};return T.addOne(i,Object.assign(Object.assign({},t),{apiWorking:!0}))}),(0,d.on)(G,(t,{fileId:o,progress:n,downloadUrl:i})=>{var s,r;const u={id:o,changes:{progress:null!=n?n:null===(s=t.entities[o])||void 0===s?void 0:s.progress,downloadUrl:null!=i?i:null===(r=t.entities[o])||void 0===r?void 0:r.downloadUrl}};return T.updateOne(u,Object.assign(Object.assign({},t),{apiWorking:!0}))}),(0,d.on)(R,(t,{fileId:o})=>{const n={id:o,changes:{completed:!0,completedDate:(new Date).getTime()}};return T.updateOne(n,Object.assign(Object.assign({},t),{apiWorking:!1}))}),(0,d.on)(re,(t,{errMsg:o})=>Object.assign(Object.assign({},t),{apiWorking:!1,error:!0,errMsg:o})),(0,d.on)(Y,(t,{photoData:o})=>T.updateOne({id:o.id,changes:{urlUploaded:!1}},Object.assign(Object.assign({},t),{apiWorking:!0}))),(0,d.on)(se,(t,{photoData:o})=>{var n;const i={id:o.id,changes:{urlUploaded:!0}},s=[...null!==(n=t.filesUploadedAndUrlAddedToDb)&&void 0!==n?n:[]];return s.push(o),T.updateOne(i,Object.assign(Object.assign({},t),{apiWorking:!1,filesUploadedAndUrlAddedToDb:s}))}),(0,d.on)(ae,(t,{errMsg:o})=>Object.assign(Object.assign({},t),{apiWorking:!1,error:!0,errMsg:o})));function He(t,o){return je(t,o)}const D=(0,d.ZF)(le),ue=((0,d.P1)(D,T.getSelectors().selectIds),(0,d.P1)(D,T.getSelectors().selectEntities),(0,d.P1)(D,T.getSelectors().selectAll)),ke=(0,d.P1)(D,T.getSelectors().selectTotal),We=(0,d.P1)(D,t=>t.apiWorking),$=(0,d.P1)(D,t=>t.filesUploadedAndUrlAddedToDb),Qe=(0,d.P1)(ke,$,(t,o)=>t===o.length),Re=(0,d.P1)(ue,$,(t,o)=>({total:t,uploadings:o}));var Ge=h(5439);let pe=(()=>{class t{constructor(n){this.storage=n}uploadBlob(n,i){const s="uploader-app/"+this.getCurrentTime()+"/"+i,r=this.storage.ref(s),u=r.put(n);return{ref:r,task:u}}getCurrentTime(){return Ge().format("MM-DD-YYYY")}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(W.Q1))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=h(5265),z=h(2843),I=h(4004),H=h(262);let $e=(()=>{class t{constructor(n,i){this.firestore=n,this.storage=i}createDocument(n,i){const s=(0,M.JU)(this.firestore,"uploader/"+i);return(0,M.pl)(s,n)}updateDocument(n){if(n){const i=(0,M.JU)(this.firestore,"uploader/");return(0,M.r7)(i,{amount:n})}return Promise.resolve()}addDocumentToCollection(n,i){const s=(0,M.JU)((0,M.hJ)(this.firestore,"uploader/"+i)),r=s.id,u=Object.assign(Object.assign({},n),{id:r});return{operationObs:(0,M.pl)(s,u),id:r}}getDocument(n){const i=(0,M.JU)(this.firestore,"uploader/"+n);return(0,M.KO)(i).pipe((0,j.q)(1),(0,I.U)(s=>s.data()),(0,H.K)(s=>(console.error(s),(0,z._)(()=>{const r=new Error(s);return r.timestamp=Date.now(),r}))))}getDataByCollectionName(n){const i=(0,M.hJ)(this.firestore,"uploader/");return(0,M.$k)(i).pipe((0,j.q)(1),(0,H.K)(s=>(console.error(s),(0,z._)(()=>{const r=new Error(s);return r.timestamp=Date.now(),r}))),(0,I.U)(s=>s.map(r=>{const u=r.data();return Object.assign({id:r.id},u)})))}getCollection(n){const i=(0,M.hJ)(this.firestore,"uploader/"+n);return(0,M.$k)(i).pipe((0,j.q)(1),(0,H.K)(s=>(console.error(s),(0,z._)(()=>{const r=new Error(s);return r.timestamp=Date.now(),r}))),(0,I.U)(s=>s.map(r=>{const u=r.data();return Object.assign({},u)})))}uploadBlob(n){return this.storage.ref("folder-1").put(n)}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(M.gg),e.LFG(W.Q1))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),J=(()=>{class t{constructor(n,i,s){this.store=n,this.ss=i,this.rs=s,this.filesUploadingAll$=this.store.select(ue),this.anyFilesUploading$=this.store.select(We),this.filesUploaded$=this.store.select($),this.isFilesUploadFinished$=this.store.select(Qe),this.uploadingsAndTotalFiles$=this.store.select(Re)}attachFile(n,i){this.store.dispatch(oe({file:n,fileId:i}))}cleanUpAttachedFiles(){this.store.dispatch(ie())}uploadFile(n,i){return this.ss.uploadBlob(n,i)}addPhotoUrl(n,i){return this.rs.addDocumentToCollection(n,i+"/photos")}getUserPhotos(n){return this.rs.getCollection(n+"/photos")}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(d.yh),e.LFG(pe),e.LFG($e))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var K=h(3702),ze=h(3003),B=h(9808),A=h(7093),Je=h(7423),X=h(5245),Ke=h(5899);let Xe=(()=>{class t{constructor(){this.mode="indeterminate"}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["shared-loading-bar"]],inputs:{progress:"progress",mode:"mode"},decls:2,vars:3,consts:[[1,"parent"],[3,"mode","value","color"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"mat-progress-bar",1),e.qZA()),2&n&&(e.xp6(1),e.Q6J("mode",i.mode)("value",i.progress)("color",100===i.progress?"primary":"accent"))},directives:[Ke.pW],styles:[".parent[_ngcontent-%COMP%]{height:100%}mat-progress-bar.mat-progress-bar[_ngcontent-%COMP%]{height:100%;border-radius:30px}"]}),t})();var qe=h(7121),Ve=h(837);function et(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"div",15)(2,"div"),e._uU(3),e.qZA()(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(3),e.hij(" Uploading ( ",n.file.progress,"% ) ")}}function tt(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"shared-loading-bar",16),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("progress",n.file.progress)("mode","determinate")}}function nt(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"div",17),e._UZ(2,"img",18),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(2),e.Q6J("src",n.imgPreview,e.LSH)}}function ot(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"a",19),e._uU(2,"Click here"),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("href",n.file.downloadUrl,e.LSH)}}function it(t,o){1&t&&e._uU(0," Creating URL... ")}function rt(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"div",3)(2,"div",4)(3,"div",5),e.YNc(4,et,4,1,"ng-container",6),e.qZA(),e.TgZ(5,"div",7)(6,"div",8),e.YNc(7,tt,2,2,"ng-container",0),e.qZA()(),e.YNc(8,nt,3,1,"ng-container",6),e.TgZ(9,"div",9),e._UZ(10,"hr"),e.qZA(),e.TgZ(11,"div",10)(12,"div",11)(13,"div",12),e._uU(14," File Name: "),e.qZA(),e.TgZ(15,"div",13),e._uU(16),e.qZA()(),e.TgZ(17,"div",11)(18,"div",12),e._uU(19," File Size: "),e.qZA(),e.TgZ(20,"div",13),e._uU(21),e.ALo(22,"fileSizeDisplay"),e.qZA()(),e.TgZ(23,"div",11)(24,"div",12),e._uU(25," Date modified: "),e.qZA(),e.TgZ(26,"div"),e._uU(27),e.ALo(28,"dateDisplay"),e.qZA()(),e.TgZ(29,"div",11)(30,"div",12),e._uU(31," Download URL: "),e.qZA(),e.TgZ(32,"div"),e.YNc(33,ot,3,1,"ng-container",6),e.YNc(34,it,1,0,"ng-template",null,14,e.W1O),e.qZA()()()()(),e.BQk()),2&t){const n=e.MAs(35),i=e.oxw(),s=e.MAs(2),r=e.MAs(4);e.xp6(4),e.Q6J("ngIf",i.file.progress<100)("ngIfElse",s),e.xp6(3),e.Q6J("ngIf",i.file.progress),e.xp6(1),e.Q6J("ngIf",i.isImgType)("ngIfElse",r),e.xp6(8),e.hij(" ",i.file.fileName," "),e.xp6(5),e.hij(" ",e.lcZ(22,10,i.file.fileSize)," "),e.xp6(6),e.hij(" ",e.xi3(28,12,i.file.dateModified,"MDY")," "),e.xp6(6),e.Q6J("ngIf",i.file.downloadUrl)("ngIfElse",n)}}function st(t,o){1&t&&(e.TgZ(0,"div",15)(1,"div",20)(2,"mat-icon",21),e._uU(3,"check_circle"),e.qZA()(),e.TgZ(4,"div"),e._uU(5," Completed "),e.qZA()())}function at(t,o){1&t&&(e.TgZ(0,"div",17)(1,"mat-icon",22),e._uU(2," description "),e.qZA()())}const lt=["image/jpeg","image/png","image/gif"];let ct=(()=>{class t{constructor(){this.isImgType=!1,this.reader=new FileReader}ngOnInit(){}ngOnChanges(n){var i,s,r;this.imgId!==n.file.currentValue.id&&(null===(i=this.file)||void 0===i?void 0:i.file)&&(this.isImgType=!!lt.includes(this.file.file.type),this.reader.onload=u=>this.imgPreview=this.reader.result,this.reader.readAsDataURL(null===(s=this.file)||void 0===s?void 0:s.file)),this.imgId||(this.imgId=null===(r=this.file)||void 0===r?void 0:r.id)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-upload-item"]],inputs:{file:"file"},features:[e.TTD],decls:5,vars:1,consts:[[4,"ngIf"],["finished",""],["notImg",""],[1,"file-parent"],[1,"card"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px",1,"loading-status","poppins"],[4,"ngIf","ngIfElse"],["fxLayout","row","fxLayoutAlign","center center"],[1,"progress-parent"],[1,"w-100"],["fxLayout","column","fxLayoutAlign","start start","fxLayoutGap","5px",1,"w-100","poppins","info-parent"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","10px",1,"info-line"],[1,"label"],[1,"value"],["noUrl",""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px"],[3,"progress","mode"],[1,"image-parent"],[1,"preview-img",3,"src"],["download","hi",3,"href"],["fxLayout","column","fxLayoutAlign","center center"],[1,"done"],["fxLayout","row","fxLayoutAlign","center center",1,"file-icon"]],template:function(n,i){1&n&&(e.YNc(0,rt,36,15,"ng-container",0),e.YNc(1,st,6,0,"ng-template",null,1,e.W1O),e.YNc(3,at,3,0,"ng-template",null,2,e.W1O)),2&n&&e.Q6J("ngIf",i.file)},directives:[B.O5,A.xw,A.Wh,A.SQ,Xe,X.Hw],pipes:[qe.nV,Ve.o],styles:[".file-parent[_ngcontent-%COMP%]{margin-top:30px}.file-parent[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-top-right-radius:25px;border-top-left-radius:25px;background-color:#ededf7}.file-parent[_ngcontent-%COMP%]   .loading-status[_ngcontent-%COMP%]{font-size:13px;height:2rem}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]{height:15rem;width:100%;overflow:hidden;text-align:center}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]   .preview-img[_ngcontent-%COMP%]{height:100%}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .progress-parent[_ngcontent-%COMP%]{height:10px;width:97%;margin-bottom:8px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]{padding:0 10px 10px;height:7rem;overflow:hidden;font-size:11px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .info-line[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}.file-parent[_ngcontent-%COMP%]   mat-icon.done[_ngcontent-%COMP%]{font-size:18px;color:#093;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.progress[_ngcontent-%COMP%]{font-size:18px;color:#b38600;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.file-icon[_ngcontent-%COMP%]{font-size:10rem;height:15rem;width:100%;color:#555}"]}),t})();var dt=h(7579);let ut=(()=>{class t{constructor(){this.wholePage=!1,this.loading=!0,this.logoShakeState=!1,this.compDest$=new dt.x}ngOnChanges(n){this.parentClass=this.wholePage?"whole-page loading-container":"container loading-container mt-5"}ngOnInit(){}ngOnDestroy(){this.compDest$.next(null),this.compDest$.complete()}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-shared-loading"]],inputs:{wholePage:"wholePage",message:"message"},features:[e.TTD],decls:12,vars:3,consts:[["fxLayout","column","fxLayoutAlign","center center",1,"w-100"],[1,""],[1,"loading-logo"],["src","assets/img/uploader.png","alt","logo",1,"logo-img","d-inline-block"],[1,"loading-parent"],[1,"lds-facebook"],[1,"secfont"]],template:function(n,i){1&n&&(e.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"div",2),e._UZ(4,"img",3),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5),e._UZ(7,"div")(8,"div")(9,"div"),e.qZA()(),e.TgZ(10,"div",6),e._uU(11),e.qZA()()()),2&n&&(e.Tol(i.parentClass),e.xp6(11),e.hij(" Loading ",i.message," ... "))},directives:[A.xw,A.Wh],styles:[".loading-logo[_ngcontent-%COMP%]{height:3rem}.loading-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.loading-parent[_ngcontent-%COMP%]{justify-content:center;align-items:center}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.whole-page[_ngcontent-%COMP%]{position:fixed;width:100%}.lds-facebook[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;position:absolute;left:8px;width:16px;background:#007bff;animation:lds-facebook 1.2s cubic-bezier(0,.5,.5,1) infinite}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){left:8px;animation-delay:-.24s}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){left:32px;animation-delay:-.12s}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(3){left:56px;animation-delay:0}@keyframes lds-facebook{0%{top:8px;height:64px}50%,to{top:24px;height:32px}}"]}),t})();function pt(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"div",2),e._uU(2),e.qZA(),e.BQk()),2&t){const n=e.oxw();e.xp6(2),e.hij(" Welcome back ",n.currentUser.email,", what are you uploading today? ")}}const ft=function(){return["/","auth","signin"]};function gt(t,o){1&t&&(e.TgZ(0,"div",3)(1,"div",4),e._uU(2," Hello! "),e.qZA(),e.TgZ(3,"div",5)(4,"div"),e._UZ(5,"img",6),e.qZA(),e.TgZ(6,"div",7)(7,"mat-icon",8),e._uU(8,"face"),e.qZA()()(),e.TgZ(9,"div",9)(10,"a",10),e._uU(11,"Create a Uploader account to get started."),e.qZA()()()),2&t&&(e.xp6(10),e.Q6J("routerLink",e.DdM(1,ft)))}let mt=(()=>{class t{constructor(){this.fileList=[]}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main-welcome"]],inputs:{currentUser:"currentUser",fileList:"fileList"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noUser",""],[1,"poppins","user","gray-text"],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","20px",1,"no-user"],[1,"poppins","main"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px"],["src","assets/img/uploader.png","alt","logo",1,"logo-img"],["fxLayout","row","fxLayoutAlign","center center"],[1,"welcome-icon"],[1,"poppins"],[3,"routerLink"]],template:function(n,i){if(1&n&&(e.YNc(0,pt,3,1,"ng-container",0),e.YNc(1,gt,12,2,"ng-template",null,1,e.W1O)),2&n){const s=e.MAs(2);e.Q6J("ngIf",i.currentUser)("ngIfElse",s)}},directives:[B.O5,A.xw,A.Wh,A.SQ,X.Hw,N.yS],styles:[".no-user[_ngcontent-%COMP%]   .logo-img[_ngcontent-%COMP%]{height:4rem}.no-user[_ngcontent-%COMP%]   .welcome-icon[_ngcontent-%COMP%]{font-size:4.7rem;height:4.7rem;width:4.7rem;color:#5f5dbb}.no-user[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]{font-size:32px;color:#5f5dbb}.no-user[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#5f5dbb}.user[_ngcontent-%COMP%]{font-size:20px}"]}),t})();const ht=["uploadInput"];function _t(t,o){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const n=e.oxw().ngIf;e.xp6(1),e.AsE(" Done: ",n.uploadings.length," / ",n.total.length," files uploaded. ")}}function yt(t,o){if(1&t&&e._uU(0),2&t){const n=e.oxw().ngIf;e.AsE(" File uploading: ",n.uploadings.length," / ",n.total.length," ... ")}}function Ut(t,o){if(1&t&&(e.ynx(0),e.YNc(1,_t,2,2,"ng-container",0),e.ALo(2,"async"),e.YNc(3,yt,1,2,"ng-template",null,15,e.W1O),e.BQk()),2&t){const n=e.MAs(4),i=e.oxw(4);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,i.fs.isFilesUploadFinished$))("ngIfElse",n)}}function vt(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"div",16),e._UZ(2,"app-upload-item",17),e.qZA(),e.BQk()),2&t){const n=o.$implicit;e.xp6(2),e.Q6J("file",n)}}function xt(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"div",11)(2,"div",12),e.YNc(3,Ut,5,4,"ng-container",10),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"section",13),e.YNc(6,vt,3,1,"ng-container",14),e.qZA()(),e.BQk()),2&t){const n=e.oxw().ngIf,i=e.oxw(2);e.xp6(3),e.Q6J("ngIf",e.lcZ(4,3,i.fs.uploadingsAndTotalFiles$)),e.xp6(3),e.Q6J("ngForOf",n)("ngForTrackBy",i.trackById)}}function Ot(t,o){if(1&t&&(e.ynx(0),e.YNc(1,xt,7,5,"ng-container",0),e.BQk()),2&t){const n=o.ngIf;e.oxw(2);const i=e.MAs(5);e.xp6(1),e.Q6J("ngIf",n.length>0)("ngIfElse",i)}}function Mt(t,o){if(1&t){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",3)(2,"input",4,5),e.NdJ("change",function(s){return e.CHM(n),e.oxw().onFileInputClick(s)}),e.qZA()(),e.TgZ(4,"div",6)(5,"div",7),e.NdJ("click",function(){return e.CHM(n),e.oxw().onFileUpload()}),e.TgZ(6,"div",8),e._uU(7," Select items to upload "),e.qZA(),e.TgZ(8,"div")(9,"button",9),e.ALo(10,"async"),e.TgZ(11,"mat-icon"),e._uU(12,"file_upload"),e.qZA()()()(),e.YNc(13,Ot,2,2,"ng-container",10),e.ALo(14,"async"),e.qZA(),e.BQk()}if(2&t){const n=e.oxw();e.xp6(9),e.Q6J("disabled",!e.lcZ(10,2,n.as.currentUser$)),e.xp6(4),e.Q6J("ngIf",e.lcZ(14,4,n.fs.filesUploadingAll$))}}function Ct(t,o){1&t&&(e.TgZ(0,"div",11),e._UZ(1,"app-shared-loading"),e.qZA())}function At(t,o){if(1&t&&(e._UZ(0,"app-main-welcome",18),e.ALo(1,"async")),2&t){const n=e.oxw();e.Q6J("currentUser",e.lcZ(1,1,n.as.currentUser$))}}const Pt=[{path:"",component:xe,children:[{path:"",redirectTo:"upload",pathMatch:"full"},{path:"upload",component:(()=>{class t{constructor(n,i,s,r){this.fs=n,this.rs=i,this.as=s,this.ts=r}ngOnInit(){}onFileUpload(){var n;const i=null===(n=this.uploadInput)||void 0===n?void 0:n.nativeElement;i&&this.as.currentUser$.pipe((0,j.q)(1)).subscribe(s=>{s?i.click():this.ts.openSingletonToast("warning","You are not logged in.")})}onFileInputClick(n){var i;const s=null===(i=n.target)||void 0===i?void 0:i.files;s&&(this.fs.cleanUpAttachedFiles(),Object.keys(s).forEach(u=>{this.fs.attachFile(s[u],(new Date).getTime()+u+"")}))}trackById(n,i){return i.id}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(J),e.Y36(pe),e.Y36(K.e),e.Y36(ze.q))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main-all"]],viewQuery:function(n,i){if(1&n&&e.Gf(ht,5),2&n){let s;e.iGM(s=e.CRH())&&(i.uploadInput=s.first)}},decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],["welcome",""],[1,""],["type","file","multiple","",1,"upload-input",3,"change"],["uploadInput",""],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","45px",1,"w-100"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","15px",1,"quicksand","upload-action",3,"click"],[1,"text"],["mat-fab","","color","primary","aria-label","Upload files",3,"disabled"],[4,"ngIf"],[1,"w-100"],["fxLayout","row","fxLayoutAlign","center center",1,"roboto","uploading-title"],["fxLayout","row wrap","fxLayoutAlign","start center","fxLayoutGap","15px",1,"w-100"],[4,"ngFor","ngForOf","ngForTrackBy"],["uploading",""],["fxFlex.gt-sm","23","fxFlex","100"],[3,"file"],[3,"currentUser"]],template:function(n,i){if(1&n&&(e.YNc(0,Mt,15,6,"ng-container",0),e.ALo(1,"async"),e.YNc(2,Ct,2,0,"ng-template",null,1,e.W1O),e.YNc(4,At,2,3,"ng-template",null,2,e.W1O)),2&n){const s=e.MAs(3);e.Q6J("ngIf",!1===e.lcZ(1,2,i.as.apiLoading$))("ngIfElse",s)}},directives:[B.O5,A.xw,A.Wh,A.SQ,Je.lW,X.Hw,B.sg,A.yH,ct,ut,mt],pipes:[B.Ov],styles:[".upload-action[_ngcontent-%COMP%]{border:1px solid #ccc;padding:5px 25px;border-radius:30px;background-color:#e6f2ff;cursor:pointer}.upload-action[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:20px;color:#5f5dbb}.upload-input[_ngcontent-%COMP%]{display:none;height:0px}.uploading-title[_ngcontent-%COMP%]{color:#888;font-size:19px}"]}),t})(),data:{pageTitle:"Upload Files"}}]}];let Tt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[N.Bz.forChild(Pt)],N.Bz]}),t})();var fe=h(3900),It=h(9770),q=h(9646),Lt=h(1884);const V=(0,d.PH)("[Upload/API] Get user files start",(0,d.Ky)()),ge=(0,d.PH)("[Upload/API] Get user files successful",(0,d.Ky)()),me=((0,d.PH)("[Upload/API] Get user files failed",(0,d.Ky)()),(0,d.PH)("[Upload/API] User is not logged in to fetch files"));let Zt=(()=>{class t{constructor(n,i,s){this.actions$=n,this.us=i,this.as=s,this.getUserFiles$=(0,x.GW)(()=>this.actions$.pipe((0,x.l4)(V),(0,I.U)(r=>r.user),(0,fe.w)(r=>function Ft(t,o,n){return(0,It.P)(()=>t()?o:n)}(()=>!!r,this.us.getUserPhotos(null==r?void 0:r.email).pipe((0,I.U)(u=>ge({files:u}))),(0,q.of)(me()))))),this.userChange$=(0,x.GW)(()=>this.as.currentUser$.pipe((0,Lt.x)((r,u)=>(null==r?void 0:r.email)===(null==u?void 0:u.email)),(0,fe.w)(r=>(0,q.of)(V({user:r})))))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(x.eX),e.LFG(J),e.LFG(K.e))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();const ee=de({selectId:function Dt(t){return t.id},sortComparer:function Bt(t,o){return t.dateUploaded&&o.dateUploaded?t.dateUploaded<o.dateUploaded?1:-1:1}}),Nt=ee.getInitialState({apiWorking:!1,errMsg:void 0,error:!1}),jt=(0,d.Lq)(Nt,(0,d.on)(V,t=>Object.assign(Object.assign({},t),{apiWorking:!0})),(0,d.on)(ge,(t,{files:o})=>ee.setAll(o,Object.assign(Object.assign({},t),{apiWorking:!1}))),(0,d.on)(me,t=>ee.removeAll(Object.assign(Object.assign({},t),{apiWorking:!1}))));function Ht(t,o){return jt(t,o)}var he=h(5577),te=h(8746),_e=h(9300),kt=h(7272);const Wt=[(()=>{class t{constructor(n,i,s){this.actions$=n,this.us=i,this.as=s,this.attachFileForUpload$=(0,x.GW)(()=>this.actions$.pipe((0,x.l4)(oe),(0,I.U)(r=>Q({fileId:r.fileId,file:r.file})))),this.uploadFileStart$=(0,x.GW)(()=>this.actions$.pipe((0,x.l4)(Q),(0,he.z)(r=>{var u;const U=r.fileId,C=r.file,E=null!==(u=C.name)&&void 0!==u?u:"File-name-"+(new Date).getTime(),w=(new Date).getTime(),P=this.us.uploadFile(C,E);let L=[P.task.percentageChanges().pipe((0,I.U)(O=>({fileId:U,percent:O})),(0,te.x)(()=>{console.log("Upload done")})),P.ref.getDownloadURL().pipe((0,I.U)(O=>({fileId:U,url:O})),(0,te.x)(()=>{console.log("Fetch URL done")}))];return(0,kt.z)(...L).pipe((0,I.U)(O=>{var S;const m=null!==(S=O.percent)&&void 0!==S?S:O.url?100:O.percent;return G({fileId:U,fileSize:r.file.size,uploadDate:w,downloadUrl:O.url,progress:m})}),(0,H.K)(O=>(console.error("Upload Error!"+O),(0,q.of)(re({errMsg:O})))),(0,te.x)(()=>{console.log("Upload and URL done")}))}))),this.uploadFileFinished$=(0,x.GW)(()=>this.actions$.pipe((0,x.l4)(G),(0,_e.h)(r=>!(!r.downloadUrl||100!==r.progress)),(0,I.U)(r=>R({fileId:r.fileId,fileSize:r.fileSize,uploadDate:r.uploadDate,downloadUrl:r.downloadUrl})))),this.updateUserPhotoDatabaseAfterUploadSuccess$=(0,x.GW)(()=>this.actions$.pipe((0,x.l4)(R),(0,I.U)(r=>Y({photoData:{id:r.fileId,dateUploaded:r.uploadDate,fileName:r.fileId,fileSize:r.fileSize,photoUrl:r.downloadUrl}})))),this.updateUserPhotoDatabase$=(0,x.GW)(()=>this.actions$.pipe((0,x.l4)(Y),(0,x.IC)(()=>this.as.currentUser$),(0,_e.h)(r=>{var u;return!!(null===(u=r[1])||void 0===u?void 0:u.email)}),(0,he.z)(r=>{var u;const U=null===(u=r[1])||void 0===u?void 0:u.email,E=this.us.addPhotoUrl(r[0].photoData,U).operationObs,w=r[0].photoData.id;return E.then(P=>{const L=Object.assign(Object.assign({},r[0].photoData),{id:w});return se({photoData:L})}).catch(P=>ae({errMsg:P}))})))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(x.eX),e.LFG(J),e.LFG(K.e))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})()];let Qt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[],imports:[[ve.n,ye.I,Ue.d,d.Aw.forFeature(le,He),d.Aw.forFeature("userFiles",Ht),x.sQ.forFeature(Wt),x.sQ.forFeature([Zt]),W.TE,Tt]]}),t})()}}]);