"use strict";(self.webpackChunkuploader=self.webpackChunkuploader||[]).push([[598],{5223:(lt,K,y)=>{y.r(K),y.d(K,{MainModule:()=>at});var R=y(3271),C=y(6991),m=y(5620),le=y(61),ce=y(7462),de=y(4987),H=y(3287),e=y(5e3);let ue=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main"]],decls:2,vars:0,consts:[[1,"container","mb-5","mt-3"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"router-outlet"),e.qZA())},directives:[H.lC],styles:[""]}),t})();const $=(0,m.PH)("[Upload/UI] attach a file",(0,m.Ky)()),X=(0,m.PH)("[Upload/UI] Remove all attached files"),z=(0,m.PH)("[Upload/API] Upload file start",(0,m.Ky)()),Q=(0,m.PH)("[Upload/API] Upload file successful",(0,m.Ky)()),V=(0,m.PH)("[Upload/API] Upload file failed",(0,m.Ky)()),k=(0,m.PH)("[Upload/API] Upload file progress update",(0,m.Ky)()),W=(0,m.PH)("[Upload/API] Update new photo in user DB start",(0,m.Ky)()),q=(0,m.PH)("[Upload/API] Update new photo in user DB successful",(0,m.Ky)()),ee=(0,m.PH)("[Upload/API] Update new photo in user DB failed",(0,m.Ky)()),te="uploadFiles";var u=(()=>{return(t=u||(u={}))[t.EntitiesOnly=0]="EntitiesOnly",t[t.Both=1]="Both",t[t.None=2]="None",u;var t})();function v(t){return function(n,o){const s={ids:[...o.ids],entities:Object.assign({},o.entities)},r=t(n,s);return r===u.Both?Object.assign({},o,s):r===u.EntitiesOnly?Object.assign(Object.assign({},o),{entities:s.entities}):o}}function _(t,i){const n=i(t);return(0,e.X6Q)()&&void 0===n&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",t,"The `selectId` implementation:",i.toString()),n}function ne(t){function i(g,c){const l=_(g,t);return l in c.entities?u.None:(c.ids.push(l),c.entities[l]=g,u.Both)}function n(g,c){let l=!1;for(const a of g)l=i(a,c)!==u.None||l;return l?u.Both:u.None}function s(g,c){const l=_(g,t);return l in c.entities?(c.entities[l]=g,u.EntitiesOnly):(c.ids.push(l),c.entities[l]=g,u.Both)}function U(g,c){const a=(g instanceof Array?g:c.ids.filter(d=>g(c.entities[d]))).filter(d=>d in c.entities).map(d=>delete c.entities[d]).length>0;return a&&(c.ids=c.ids.filter(d=>d in c.entities)),a?u.Both:u.None}function L(g,c){return T([g],c)}function T(g,c){const l={};return(g=g.filter(d=>d.id in c.entities)).length>0?g.filter(f=>function E(g,c,l){const d=Object.assign({},l.entities[c.id],c.changes),f=_(d,t),h=f!==c.id;return h&&(g[c.id]=f,delete l.entities[c.id]),l.entities[f]=d,h}(l,f,c)).length>0?(c.ids=c.ids.map(f=>l[f]||f),u.Both):u.EntitiesOnly:u.None}function D(g,c){const l=[],a=[];for(const h of g){const O=_(h,t);O in c.entities?a.push({id:O,changes:h}):l.push(h)}const d=T(a,c),f=n(l,c);switch(!0){case f===u.None&&d===u.None:return u.None;case f===u.Both||d===u.Both:return u.Both;default:return u.EntitiesOnly}}return{removeAll:function A(g){return Object.assign({},g,{ids:[],entities:{}})},addOne:v(i),addMany:v(n),setAll:v(function o(g,c){return c.ids=[],c.entities={},n(g,c),u.Both}),setOne:v(s),setMany:v(function r(g,c){const l=g.map(a=>s(a,c));switch(!0){case l.some(a=>a===u.Both):return u.Both;case l.some(a=>a===u.EntitiesOnly):return u.EntitiesOnly;default:return u.None}}),updateOne:v(L),updateMany:v(T),upsertOne:v(function x(g,c){return D([g],c)}),upsertMany:v(D),removeOne:v(function p(g,c){return U([g],c)}),removeMany:v(U),map:v(function F(g,c){return T(c.ids.reduce((d,f)=>{const h=g(c.entities[f]);return h!==c.entities[f]&&d.push({id:f,changes:h}),d},[]).filter(({id:d})=>d in c.entities),c)}),mapOne:v(function j({map:g,id:c},l){const a=l.entities[c];return a?L({id:c,changes:g(a)},l):u.None})}}const I=function Te(t={}){var i,n;const{selectId:o,sortComparer:s}={selectId:null!==(i=t.selectId)&&void 0!==i?i:A=>A.id,sortComparer:null!==(n=t.sortComparer)&&void 0!==n&&n},r=function xe(){return{getInitialState:function t(i={}){return Object.assign({ids:[],entities:{}},i)}}}(),p=function Ae(){return{getSelectors:function t(i){const n=p=>p.ids,o=p=>p.entities,s=(0,m.P1)(n,o,(p,U)=>p.map(A=>U[A])),r=(0,m.P1)(n,p=>p.length);return i?{selectIds:(0,m.P1)(i,n),selectEntities:(0,m.P1)(i,o),selectAll:(0,m.P1)(i,s),selectTotal:(0,m.P1)(i,r)}:{selectIds:n,selectEntities:o,selectAll:s,selectTotal:r}}}}(),U=s?function Ce(t,i){const{removeOne:n,removeMany:o,removeAll:s}=ne(t);function r(l,a){return p([l],a)}function p(l,a){const d=l.filter(f=>!(_(f,t)in a.entities));return 0===d.length?u.None:(c(d,a),u.Both)}function A(l,a){const d=_(l,t);return d in a.entities?(a.ids=a.ids.filter(f=>f!==d),c([l],a),u.Both):r(l,a)}function L(l,a){return F([l],a)}function F(l,a){const d=[],f=l.filter(h=>function T(l,a,d){if(!(a.id in d.entities))return!1;const h=Object.assign({},d.entities[a.id],a.changes),O=_(h,t);return delete d.entities[a.id],l.push(h),O!==a.id}(d,h,a)).length>0;if(0===d.length)return u.None;{const h=a.ids,O=[];return a.ids=a.ids.filter((P,w)=>P in a.entities||(O.push(w),!1)),c(d,a),!f&&O.every(P=>a.ids[P]===h[P])?u.EntitiesOnly:u.Both}}function g(l,a){const d=[],f=[];for(const P of l){const w=_(P,t);w in a.entities?f.push({id:w,changes:P}):d.push(P)}const h=F(f,a),O=p(d,a);switch(!0){case O===u.None&&h===u.None:return u.None;case O===u.Both||h===u.Both:return u.Both;default:return u.EntitiesOnly}}function c(l,a){l.sort(i);const d=[];let f=0,h=0;for(;f<l.length&&h<a.ids.length;){const O=l[f],P=_(O,t),w=a.ids[h];i(O,a.entities[w])<=0?(d.push(P),f++):(d.push(w),h++)}a.ids=d.concat(f<l.length?l.slice(f).map(t):a.ids.slice(h)),l.forEach((O,P)=>{a.entities[t(O)]=O})}return{removeOne:n,removeMany:o,removeAll:s,addOne:v(r),updateOne:v(L),upsertOne:v(function D(l,a){return g([l],a)}),setAll:v(function U(l,a){return a.entities={},a.ids=[],p(l,a),u.Both}),setOne:v(A),setMany:v(function E(l,a){const d=l.map(f=>A(f,a));switch(!0){case d.some(f=>f===u.Both):return u.Both;case d.some(f=>f===u.EntitiesOnly):return u.EntitiesOnly;default:return u.None}}),addMany:v(p),updateMany:v(F),upsertMany:v(g),map:v(function j(l,a){return F(a.ids.reduce((f,h)=>{const O=l(a.entities[h]);return O!==a.entities[h]&&f.push({id:h,changes:O}),f},[]),a)}),mapOne:v(function x({map:l,id:a},d){const f=d.entities[a];return f?L({id:a,changes:l(f)},d):u.None})}}(o,s):ne(o);return Object.assign(Object.assign(Object.assign({selectId:o,sortComparer:s},r),p),U)}({selectId:function Ie(t){return t.id},sortComparer:function Pe(t,i){return t.attachDate&&i.attachDate?t.attachDate<i.attachDate?1:-1:1}}),Fe=I.getInitialState({apiWorking:!1,filesUploadedAndUrlAddedToDb:[],errMsg:void 0,error:!1}),_e=(0,m.Lq)(Fe,(0,m.on)(X,t=>I.removeAll(Object.assign(Object.assign({},t),{apiWorking:!1,error:!1,errMsg:void 0,filesUploadedAndUrlAddedToDb:[]}))),(0,m.on)(z,(t,{file:i,fileId:n})=>{const o={attachDate:(new Date).getTime(),dateModified:i.lastModified,file:i,fileName:i.name,fileSize:i.size,id:n,completed:!1,progress:0,downloadUrl:void 0};return I.addOne(o,Object.assign(Object.assign({},t),{apiWorking:!0}))}),(0,m.on)(k,(t,{fileId:i,progress:n,downloadUrl:o})=>{var s,r;const p={id:i,changes:{progress:null!=n?n:null===(s=t.entities[i])||void 0===s?void 0:s.progress,downloadUrl:null!=o?o:null===(r=t.entities[i])||void 0===r?void 0:r.downloadUrl}};return I.updateOne(p,Object.assign(Object.assign({},t),{apiWorking:!0}))}),(0,m.on)(Q,(t,{fileId:i})=>{const n={id:i,changes:{completed:!0,completedDate:(new Date).getTime()}};return I.updateOne(n,Object.assign(Object.assign({},t),{apiWorking:!1}))}),(0,m.on)(V,(t,{errMsg:i})=>Object.assign(Object.assign({},t),{apiWorking:!1,error:!0,errMsg:i})),(0,m.on)(W,(t,{photoData:i})=>I.updateOne({id:i.id,changes:{urlUploaded:!1}},Object.assign(Object.assign({},t),{apiWorking:!0}))),(0,m.on)(q,(t,{photoData:i})=>{var n;const o={id:i.id,changes:{urlUploaded:!0}},s=[...null!==(n=t.filesUploadedAndUrlAddedToDb)&&void 0!==n?n:[]];return s.push(i),I.updateOne(o,Object.assign(Object.assign({},t),{apiWorking:!1,filesUploadedAndUrlAddedToDb:s}))}),(0,m.on)(ee,(t,{errMsg:i})=>Object.assign(Object.assign({},t),{apiWorking:!1,error:!0,errMsg:i})));function be(t,i){return _e(t,i)}const B=(0,m.ZF)(te),Ee=((0,m.P1)(B,I.getSelectors().selectIds),(0,m.P1)(B,I.getSelectors().selectEntities),(0,m.P1)(B,I.getSelectors().selectAll)),Le=((0,m.P1)(B,I.getSelectors().selectTotal),(0,m.P1)(B,t=>t.apiWorking));var De=y(5439);let oe=(()=>{class t{constructor(n){this.storage=n}uploadBlob(n,o){const s="uploader-app/"+this.getCurrentTime()+"/"+o,r=this.storage.ref(s),p=r.put(n);return{ref:r,task:p}}getCurrentTime(){return De().format("MM-DD-YYYY")}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(R.Q1))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=y(5265),J=y(2843),G=y(5698),b=y(4004),Z=y(262);let we=(()=>{class t{constructor(n,o){this.firestore=n,this.storage=o}createDocument(n,o){const s=(0,M.JU)(this.firestore,"uploader/"+o);return(0,M.pl)(s,n)}updateDocument(n){if(n){const o=(0,M.JU)(this.firestore,"uploader/");return(0,M.r7)(o,{amount:n})}return Promise.resolve()}addDocumentToCollection(n,o){const s=(0,M.JU)((0,M.hJ)(this.firestore,"uploader/"+o)),r=s.id,p=Object.assign(Object.assign({},n),{id:r});return{operationObs:(0,M.pl)(s,p),id:r}}getDocument(n){const o=(0,M.JU)(this.firestore,"uploader/"+n);return(0,M.KO)(o).pipe((0,G.q)(1),(0,b.U)(s=>s.data()),(0,Z.K)(s=>(console.error(s),(0,J._)(()=>{const r=new Error(s);return r.timestamp=Date.now(),r}))))}addEntryToCollection(n){const o=(0,M.JU)((0,M.hJ)(this.firestore,"uploader/")),s=o.id;return{operationObs:(0,M.pl)(o,{}),id:s}}getDataByCollectionName(n){const o=(0,M.hJ)(this.firestore,"uploader/");return(0,M.$k)(o).pipe((0,G.q)(1),(0,Z.K)(s=>(console.error(s),(0,J._)(()=>{const r=new Error(s);return r.timestamp=Date.now(),r}))),(0,b.U)(s=>s.map(r=>{const p=r.data();return Object.assign({id:r.id},p)})))}getCollection(n){const o=(0,M.hJ)(this.firestore,"uploader/"+n);return(0,M.$k)(o).pipe((0,G.q)(1),(0,Z.K)(s=>(console.error(s),(0,J._)(()=>{const r=new Error(s);return r.timestamp=Date.now(),r}))),(0,b.U)(s=>s.map(r=>{const p=r.data();return Object.assign({},p)})))}uploadBlob(n){return this.storage.ref("folder-1").put(n)}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(M.gg),e.LFG(R.Q1))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ie=(()=>{class t{constructor(n,o,s){this.store=n,this.ss=o,this.rs=s,this.filesUploadingAll$=this.store.select(Ee),this.anyFilesUploading$=this.store.select(Le)}attachFile(n,o){this.store.dispatch($({file:n,fileId:o}))}cleanUpAttachedFiles(){this.store.dispatch(X())}uploadFile(n,o){return this.ss.uploadBlob(n,o)}addPhotoUrl(n,o){return this.rs.addDocumentToCollection(n,o+"/photos")}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(m.yh),e.LFG(oe),e.LFG(we))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var S=y(7093),Be=y(7423),re=y(5245),N=y(9808),Ze=y(5899);let Ne=(()=>{class t{constructor(){this.mode="indeterminate"}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["shared-loading-bar"]],inputs:{progress:"progress",mode:"mode"},decls:2,vars:3,consts:[[1,"parent"],[3,"mode","value","color"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"mat-progress-bar",1),e.qZA()),2&n&&(e.xp6(1),e.Q6J("mode",o.mode)("value",o.progress)("color",100===o.progress?"primary":"accent"))},directives:[Ze.pW],styles:[".parent[_ngcontent-%COMP%]{height:100%}mat-progress-bar.mat-progress-bar[_ngcontent-%COMP%]{height:100%;border-radius:30px}"]}),t})();var je=y(7121),Re=y(837);function He(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",15)(2,"div"),e._uU(3),e.qZA()(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(3),e.hij(" Uploading ( ",n.file.progress,"% ) ")}}function ze(t,i){if(1&t&&(e.ynx(0),e._UZ(1,"shared-loading-bar",16),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("progress",n.file.progress)("mode","determinate")}}function Qe(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",17),e._UZ(2,"img",18),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(2),e.Q6J("src",n.imgPreview,e.LSH)}}function ke(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"a",19),e._uU(2,"Click here"),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("href",n.file.downloadUrl,e.LSH)}}function We(t,i){1&t&&e._uU(0," Creating URL... ")}function Je(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",3)(2,"div",4)(3,"div",5),e.YNc(4,He,4,1,"ng-container",6),e.qZA(),e.TgZ(5,"div",7)(6,"div",8),e.YNc(7,ze,2,2,"ng-container",0),e.qZA()(),e.YNc(8,Qe,3,1,"ng-container",6),e.TgZ(9,"div",9),e._UZ(10,"hr"),e.qZA(),e.TgZ(11,"div",10)(12,"div",11)(13,"div",12),e._uU(14," File Name: "),e.qZA(),e.TgZ(15,"div",13),e._uU(16),e.qZA()(),e.TgZ(17,"div",11)(18,"div",12),e._uU(19," File Size: "),e.qZA(),e.TgZ(20,"div",13),e._uU(21),e.ALo(22,"fileSizeDisplay"),e.qZA()(),e.TgZ(23,"div",11)(24,"div",12),e._uU(25," Date modified: "),e.qZA(),e.TgZ(26,"div"),e._uU(27),e.ALo(28,"dateDisplay"),e.qZA()(),e.TgZ(29,"div",11)(30,"div",12),e._uU(31," Download URL: "),e.qZA(),e.TgZ(32,"div"),e.YNc(33,ke,3,1,"ng-container",6),e.YNc(34,We,1,0,"ng-template",null,14,e.W1O),e.qZA()()()()(),e.BQk()),2&t){const n=e.MAs(35),o=e.oxw(),s=e.MAs(2),r=e.MAs(4);e.xp6(4),e.Q6J("ngIf",o.file.progress<100)("ngIfElse",s),e.xp6(3),e.Q6J("ngIf",o.file.progress),e.xp6(1),e.Q6J("ngIf",o.isImgType)("ngIfElse",r),e.xp6(8),e.hij(" ",o.file.fileName," "),e.xp6(5),e.hij(" ",e.lcZ(22,10,o.file.fileSize)," "),e.xp6(6),e.hij(" ",e.xi3(28,12,o.file.dateModified,"MDY")," "),e.xp6(6),e.Q6J("ngIf",o.file.downloadUrl)("ngIfElse",n)}}function Ge(t,i){1&t&&(e.TgZ(0,"div",15)(1,"div",20)(2,"mat-icon",21),e._uU(3,"check_circle"),e.qZA()(),e.TgZ(4,"div"),e._uU(5," Completed "),e.qZA()())}function Ye(t,i){1&t&&(e.TgZ(0,"div",17)(1,"mat-icon",22),e._uU(2," description "),e.qZA()())}const Ke=["image/jpeg","image/png","image/gif"];let $e=(()=>{class t{constructor(){this.isImgType=!1,this.reader=new FileReader}ngOnInit(){}ngOnChanges(n){var o,s,r;this.imgId!==n.file.currentValue.id&&(null===(o=this.file)||void 0===o?void 0:o.file)&&(this.isImgType=!!Ke.includes(this.file.file.type),this.reader.onload=p=>this.imgPreview=this.reader.result,this.reader.readAsDataURL(null===(s=this.file)||void 0===s?void 0:s.file)),this.imgId||(this.imgId=null===(r=this.file)||void 0===r?void 0:r.id)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-upload-item"]],inputs:{file:"file"},features:[e.TTD],decls:5,vars:1,consts:[[4,"ngIf"],["finished",""],["notImg",""],[1,"file-parent"],[1,"card"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px",1,"loading-status","poppins"],[4,"ngIf","ngIfElse"],["fxLayout","row","fxLayoutAlign","center center"],[1,"progress-parent"],[1,"w-100"],["fxLayout","column","fxLayoutAlign","start start","fxLayoutGap","5px",1,"w-100","poppins","info-parent"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","10px",1,"info-line"],[1,"label"],[1,"value"],["noUrl",""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px"],[3,"progress","mode"],[1,"image-parent"],[1,"preview-img",3,"src"],["download","hi",3,"href"],["fxLayout","column","fxLayoutAlign","center center"],[1,"done"],["fxLayout","row","fxLayoutAlign","center center",1,"file-icon"]],template:function(n,o){1&n&&(e.YNc(0,Je,36,15,"ng-container",0),e.YNc(1,Ge,6,0,"ng-template",null,1,e.W1O),e.YNc(3,Ye,3,0,"ng-template",null,2,e.W1O)),2&n&&e.Q6J("ngIf",o.file)},directives:[N.O5,S.xw,S.Wh,S.SQ,Ne,re.Hw],pipes:[je.nV,Re.o],styles:[".file-parent[_ngcontent-%COMP%]{margin-top:30px}.file-parent[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-top-right-radius:25px;border-top-left-radius:25px;background-color:#ededf7}.file-parent[_ngcontent-%COMP%]   .loading-status[_ngcontent-%COMP%]{font-size:13px;height:2rem}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]{height:15rem;width:100%;overflow:hidden;text-align:center}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]   .preview-img[_ngcontent-%COMP%]{height:100%}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .progress-parent[_ngcontent-%COMP%]{height:10px;width:97%;margin-bottom:8px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]{padding:0 10px 10px;height:7rem;overflow:hidden;font-size:11px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .info-line[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}.file-parent[_ngcontent-%COMP%]   mat-icon.done[_ngcontent-%COMP%]{font-size:18px;color:#093;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.progress[_ngcontent-%COMP%]{font-size:18px;color:#b38600;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.file-icon[_ngcontent-%COMP%]{font-size:10rem;height:15rem;width:100%;color:#555}"]}),t})();const Xe=["uploadInput"];function Ve(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",12),e._UZ(2,"app-upload-item",13),e.qZA(),e.BQk()),2&t){const n=i.$implicit;e.xp6(2),e.Q6J("file",n)}}function qe(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",8)(2,"div",9),e._uU(3," File Uploading .. "),e.qZA(),e.TgZ(4,"section",10),e.YNc(5,Ve,3,1,"ng-container",11),e.qZA()(),e.BQk()),2&t){const n=i.ngIf,o=e.oxw();e.xp6(5),e.Q6J("ngForOf",n)("ngForTrackBy",o.trackById)}}const et=[{path:"",component:ue,children:[{path:"",redirectTo:"upload",pathMatch:"full"},{path:"upload",component:(()=>{class t{constructor(n,o){this.fs=n,this.rs=o}ngOnInit(){}onFileUpload(){var n;const o=null===(n=this.uploadInput)||void 0===n?void 0:n.nativeElement;o&&o.click()}onFileInputClick(n){var o;const s=null===(o=n.target)||void 0===o?void 0:o.files;s&&(this.fs.cleanUpAttachedFiles(),Object.keys(s).forEach(p=>{this.fs.attachFile(s[p],(new Date).getTime()+p+"")}))}trackById(n,o){return o.id}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(ie),e.Y36(oe))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main-all"]],viewQuery:function(n,o){if(1&n&&e.Gf(Xe,5),2&n){let s;e.iGM(s=e.CRH())&&(o.uploadInput=s.first)}},decls:13,vars:3,consts:[[1,""],["type","file","multiple","",1,"upload-input",3,"change"],["uploadInput",""],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","45px",1,"w-100"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","15px",1,"quicksand","upload-action",3,"click"],[1,"text"],["mat-fab","","color","primary","aria-label","Upload files"],[4,"ngIf"],[1,"w-100"],["fxLayout","row","fxLayoutAlign","center center",1,"poppins","uploading-title"],["fxLayout","row wrap","fxLayoutAlign","start center","fxLayoutGap","15px",1,"w-100"],[4,"ngFor","ngForOf","ngForTrackBy"],["fxFlex.gt-sm","23","fxFlex","100"],[3,"file"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(r){return o.onFileInputClick(r)}),e.qZA()(),e.TgZ(3,"div",3)(4,"div",4),e.NdJ("click",function(){return o.onFileUpload()}),e.TgZ(5,"div",5),e._uU(6," Select items to upload "),e.qZA(),e.TgZ(7,"div")(8,"button",6)(9,"mat-icon"),e._uU(10,"file_upload"),e.qZA()()()(),e.YNc(11,qe,6,2,"ng-container",7),e.ALo(12,"async"),e.qZA()),2&n&&(e.xp6(11),e.Q6J("ngIf",e.lcZ(12,1,o.fs.filesUploadingAll$)))},directives:[S.xw,S.Wh,S.SQ,Be.lW,re.Hw,N.O5,N.sg,S.yH,$e],pipes:[N.Ov],styles:[".upload-action[_ngcontent-%COMP%]{border:1px solid #ccc;padding:5px 25px;border-radius:30px;background-color:#e6f2ff;cursor:pointer}.upload-action[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:20px}.upload-input[_ngcontent-%COMP%]{display:none;height:0px}.uploading-title[_ngcontent-%COMP%]{color:#888}"]}),t})(),data:{pageTitle:"Upload Files"}}]}];let tt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[H.Bz.forChild(et)],H.Bz]}),t})();var ae=y(5577),Y=y(8746),se=y(9300),nt=y(7272),ot=y(9646),it=y(3702);const rt=[(()=>{class t{constructor(n,o,s){this.actions$=n,this.us=o,this.as=s,this.attachFileForUpload$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)($),(0,b.U)(r=>z({fileId:r.fileId,file:r.file})))),this.uploadFileStart$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(z),(0,ae.z)(r=>{var p;const U=r.fileId,A=r.file,E=null!==(p=A.name)&&void 0!==p?p:"File-name-"+(new Date).getTime(),L=(new Date).getTime(),T=this.us.uploadFile(A,E);let F=[T.task.percentageChanges().pipe((0,b.U)(x=>({fileId:U,percent:x})),(0,Y.x)(()=>{console.log("Upload done")})),T.ref.getDownloadURL().pipe((0,b.U)(x=>({fileId:U,url:x})),(0,Y.x)(()=>{console.log("Fetch URL done")}))];return(0,nt.z)(...F).pipe((0,b.U)(x=>{var D;const g=null!==(D=x.percent)&&void 0!==D?D:x.url?100:x.percent;return k({fileId:U,fileSize:r.file.size,uploadDate:L,downloadUrl:x.url,progress:g})}),(0,Z.K)(x=>(console.error("Upload Error!"+x),(0,ot.of)(V({errMsg:x})))),(0,Y.x)(()=>{console.log("Upload and URL done")}))}))),this.uploadFileFinished$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(k),(0,se.h)(r=>!(!r.downloadUrl||100!==r.progress)),(0,b.U)(r=>Q({fileId:r.fileId,fileSize:r.fileSize,uploadDate:r.uploadDate,downloadUrl:r.downloadUrl})))),this.updateUserPhotoDatabaseAfterUploadSuccess$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(Q),(0,b.U)(r=>W({photoData:{id:r.fileId,dateUploaded:r.uploadDate,fileName:r.fileId,fileSize:r.fileSize,photoUrl:r.downloadUrl}})))),this.updateUserPhotoDatabase$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(W),(0,C.IC)(()=>this.as.currentUser$),(0,se.h)(r=>{var p;return!!(null===(p=r[1])||void 0===p?void 0:p.email)}),(0,ae.z)(r=>{var p;const U=null===(p=r[1])||void 0===p?void 0:p.email,E=this.us.addPhotoUrl(r[0].photoData,U).operationObs,L=r[0].photoData.id;return E.then(T=>{const F=Object.assign(Object.assign({},r[0].photoData),{id:L});return q({photoData:F})}).catch(T=>ee({errMsg:T}))})))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(C.eX),e.LFG(ie),e.LFG(it.e))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})()];let at=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[],imports:[[de.n,le.I,ce.d,m.Aw.forFeature(te,be),C.sQ.forFeature(rt),R.TE,tt]]}),t})()}}]);