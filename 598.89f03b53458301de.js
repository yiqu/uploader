"use strict";(self.webpackChunkuploader=self.webpackChunkuploader||[]).push([[598],{5223:(ae,$,y)=>{y.r($),y.d($,{MainModule:()=>ie});var R=y(3271),A=y(6991),m=y(5620),it=y(61),rt=y(7462),at=y(4987),H=y(3287),t=y(5e3);let st=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-main"]],decls:2,vars:0,consts:[[1,"container","mb-5","mt-3"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"router-outlet"),t.qZA())},directives:[H.lC],styles:[""]}),e})();const k=(0,m.PH)("[Upload/UI] attach a file",(0,m.Ky)()),z=(0,m.PH)("[Upload/API] Upload file start",(0,m.Ky)()),Q=(0,m.PH)("[Upload/API] Upload file successful",(0,m.Ky)()),ht=(0,m.PH)("[Upload/API] Upload file failed",(0,m.Ky)()),J=(0,m.PH)("[Upload/API] Upload file progress update",(0,m.Ky)()),W=(0,m.PH)("[Upload/API] Update new photo in user DB start",(0,m.Ky)()),yt=(0,m.PH)("[Upload/API] Update new photo in user DB successful",(0,m.Ky)()),vt=(0,m.PH)("[Upload/API] Update new photo in user DB failed",(0,m.Ky)()),X="uploadFiles";var u=(()=>{return(e=u||(u={}))[e.EntitiesOnly=0]="EntitiesOnly",e[e.Both=1]="Both",e[e.None=2]="None",u;var e})();function v(e){return function(n,o){const s={ids:[...o.ids],entities:Object.assign({},o.entities)},i=e(n,s);return i===u.Both?Object.assign({},o,s):i===u.EntitiesOnly?Object.assign(Object.assign({},o),{entities:s.entities}):o}}function _(e,a){const n=a(e);return(0,t.X6Q)()&&void 0===n&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",e,"The `selectId` implementation:",a.toString()),n}function V(e){function a(g,c){const l=_(g,e);return l in c.entities?u.None:(c.ids.push(l),c.entities[l]=g,u.Both)}function n(g,c){let l=!1;for(const r of g)l=a(r,c)!==u.None||l;return l?u.Both:u.None}function s(g,c){const l=_(g,e);return l in c.entities?(c.entities[l]=g,u.EntitiesOnly):(c.ids.push(l),c.entities[l]=g,u.Both)}function U(g,c){const r=(g instanceof Array?g:c.ids.filter(d=>g(c.entities[d]))).filter(d=>d in c.entities).map(d=>delete c.entities[d]).length>0;return r&&(c.ids=c.ids.filter(d=>d in c.entities)),r?u.Both:u.None}function L(g,c){return I([g],c)}function I(g,c){const l={};return(g=g.filter(d=>d.id in c.entities)).length>0?g.filter(f=>function F(g,c,l){const d=Object.assign({},l.entities[c.id],c.changes),f=_(d,e),h=f!==c.id;return h&&(g[c.id]=f,delete l.entities[c.id]),l.entities[f]=d,h}(l,f,c)).length>0?(c.ids=c.ids.map(f=>l[f]||f),u.Both):u.EntitiesOnly:u.None}function j(g,c){const l=[],r=[];for(const h of g){const O=_(h,e);O in c.entities?r.push({id:O,changes:h}):l.push(h)}const d=I(r,c),f=n(l,c);switch(!0){case f===u.None&&d===u.None:return u.None;case f===u.Both||d===u.Both:return u.Both;default:return u.EntitiesOnly}}return{removeAll:function x(g){return Object.assign({},g,{ids:[],entities:{}})},addOne:v(a),addMany:v(n),setAll:v(function o(g,c){return c.ids=[],c.entities={},n(g,c),u.Both}),setOne:v(s),setMany:v(function i(g,c){const l=g.map(r=>s(r,c));switch(!0){case l.some(r=>r===u.Both):return u.Both;case l.some(r=>r===u.EntitiesOnly):return u.EntitiesOnly;default:return u.None}}),updateOne:v(L),updateMany:v(I),upsertOne:v(function C(g,c){return j([g],c)}),upsertMany:v(j),removeOne:v(function p(g,c){return U([g],c)}),removeMany:v(U),map:v(function T(g,c){return I(c.ids.reduce((d,f)=>{const h=g(c.entities[f]);return h!==c.entities[f]&&d.push({id:f,changes:h}),d},[]).filter(({id:d})=>d in c.entities),c)}),mapOne:v(function w({map:g,id:c},l){const r=l.entities[c];return r?L({id:c,changes:g(r)},l):u.None})}}const S=function At(e={}){var a,n;const{selectId:o,sortComparer:s}={selectId:null!==(a=e.selectId)&&void 0!==a?a:x=>x.id,sortComparer:null!==(n=e.sortComparer)&&void 0!==n&&n},i=function Ot(){return{getInitialState:function e(a={}){return Object.assign({ids:[],entities:{}},a)}}}(),p=function Mt(){return{getSelectors:function e(a){const n=p=>p.ids,o=p=>p.entities,s=(0,m.P1)(n,o,(p,U)=>p.map(x=>U[x])),i=(0,m.P1)(n,p=>p.length);return a?{selectIds:(0,m.P1)(a,n),selectEntities:(0,m.P1)(a,o),selectAll:(0,m.P1)(a,s),selectTotal:(0,m.P1)(a,i)}:{selectIds:n,selectEntities:o,selectAll:s,selectTotal:i}}}}(),U=s?function xt(e,a){const{removeOne:n,removeMany:o,removeAll:s}=V(e);function i(l,r){return p([l],r)}function p(l,r){const d=l.filter(f=>!(_(f,e)in r.entities));return 0===d.length?u.None:(c(d,r),u.Both)}function x(l,r){const d=_(l,e);return d in r.entities?(r.ids=r.ids.filter(f=>f!==d),c([l],r),u.Both):i(l,r)}function L(l,r){return T([l],r)}function T(l,r){const d=[],f=l.filter(h=>function I(l,r,d){if(!(r.id in d.entities))return!1;const h=Object.assign({},d.entities[r.id],r.changes),O=_(h,e);return delete d.entities[r.id],l.push(h),O!==r.id}(d,h,r)).length>0;if(0===d.length)return u.None;{const h=r.ids,O=[];return r.ids=r.ids.filter((P,B)=>P in r.entities||(O.push(B),!1)),c(d,r),!f&&O.every(P=>r.ids[P]===h[P])?u.EntitiesOnly:u.Both}}function g(l,r){const d=[],f=[];for(const P of l){const B=_(P,e);B in r.entities?f.push({id:B,changes:P}):d.push(P)}const h=T(f,r),O=p(d,r);switch(!0){case O===u.None&&h===u.None:return u.None;case O===u.Both||h===u.Both:return u.Both;default:return u.EntitiesOnly}}function c(l,r){l.sort(a);const d=[];let f=0,h=0;for(;f<l.length&&h<r.ids.length;){const O=l[f],P=_(O,e),B=r.ids[h];a(O,r.entities[B])<=0?(d.push(P),f++):(d.push(B),h++)}r.ids=d.concat(f<l.length?l.slice(f).map(e):r.ids.slice(h)),l.forEach((O,P)=>{r.entities[e(O)]=O})}return{removeOne:n,removeMany:o,removeAll:s,addOne:v(i),updateOne:v(L),upsertOne:v(function j(l,r){return g([l],r)}),setAll:v(function U(l,r){return r.entities={},r.ids=[],p(l,r),u.Both}),setOne:v(x),setMany:v(function F(l,r){const d=l.map(f=>x(f,r));switch(!0){case d.some(f=>f===u.Both):return u.Both;case d.some(f=>f===u.EntitiesOnly):return u.EntitiesOnly;default:return u.None}}),addMany:v(p),updateMany:v(T),upsertMany:v(g),map:v(function w(l,r){return T(r.ids.reduce((f,h)=>{const O=l(r.entities[h]);return O!==r.entities[h]&&f.push({id:h,changes:O}),f},[]),r)}),mapOne:v(function C({map:l,id:r},d){const f=d.entities[r];return f?L({id:r,changes:l(f)},d):u.None})}}(o,s):V(o);return Object.assign(Object.assign(Object.assign({selectId:o,sortComparer:s},i),p),U)}({selectId:function Ct(e){return e.id},sortComparer:function It(e,a){return e.attachDate&&a.attachDate?e.attachDate<a.attachDate?1:-1:1}}),Tt=S.getInitialState({uploading:!1}),Pt=(0,m.Lq)(Tt,(0,m.on)(z,(e,{file:a,fileId:n})=>{const o={attachDate:(new Date).getTime(),dateModified:a.lastModified,file:a,fileName:a.name,fileSize:a.size,id:n,completed:!1,progress:0,downloadUrl:void 0};return S.addOne(o,Object.assign(Object.assign({},e),{uploading:!0}))}),(0,m.on)(J,(e,{fileId:a,progress:n,downloadUrl:o})=>{var s,i;const p={id:a,changes:{progress:null!=n?n:null===(s=e.entities[a])||void 0===s?void 0:s.progress,downloadUrl:null!=o?o:null===(i=e.entities[a])||void 0===i?void 0:i.downloadUrl}};return S.updateOne(p,Object.assign(Object.assign({},e),{uploading:!0}))}),(0,m.on)(Q,(e,{fileId:a})=>{const n={id:a,changes:{completed:!0,completedDate:(new Date).getTime()}};return S.updateOne(n,Object.assign(Object.assign({},e),{uploading:!1}))}));function Ft(e,a){return Pt(e,a)}const b=(0,m.ZF)(X),_t=((0,m.P1)(b,S.getSelectors().selectIds),(0,m.P1)(b,S.getSelectors().selectEntities),(0,m.P1)(b,S.getSelectors().selectAll)),Et=((0,m.P1)(b,S.getSelectors().selectTotal),(0,m.P1)(b,e=>e.uploading));var Lt=y(5439);let q=(()=>{class e{constructor(n){this.storage=n}uploadBlob(n,o){const s="uploader-app/"+this.getCurrentTime()+"/"+o,i=this.storage.ref(s),p=i.put(n);return{ref:i,task:p}}getCurrentTime(){return Lt().format("MM-DD-YYYY")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(R.Q1))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var M=y(5265),G=y(2843),Y=y(5698),E=y(4004),Z=y(262);let Dt=(()=>{class e{constructor(n,o){this.firestore=n,this.storage=o}createDocument(n,o){const s=(0,M.JU)(this.firestore,"uploader/"+o);return(0,M.pl)(s,n)}updateDocument(n){if(n){const o=(0,M.JU)(this.firestore,"uploader/");return(0,M.r7)(o,{amount:n})}return Promise.resolve()}addDocumentToCollection(n,o){const s=(0,M.JU)((0,M.hJ)(this.firestore,"uploader/"+o)),i=s.id,p=Object.assign(Object.assign({},n),{id:i});return{operationObs:(0,M.pl)(s,p),id:i}}getDocument(n){const o=(0,M.JU)(this.firestore,"uploader/"+n);return(0,M.KO)(o).pipe((0,Y.q)(1),(0,E.U)(s=>s.data()),(0,Z.K)(s=>(console.error(s),(0,G._)(()=>{const i=new Error(s);return i.timestamp=Date.now(),i}))))}addEntryToCollection(n){const o=(0,M.JU)((0,M.hJ)(this.firestore,"uploader/")),s=o.id;return{operationObs:(0,M.pl)(o,{}),id:s}}getDataByCollectionName(n){const o=(0,M.hJ)(this.firestore,"uploader/");return(0,M.$k)(o).pipe((0,Y.q)(1),(0,Z.K)(s=>(console.error(s),(0,G._)(()=>{const i=new Error(s);return i.timestamp=Date.now(),i}))),(0,E.U)(s=>s.map(i=>{const p=i.data();return Object.assign({id:i.id},p)})))}getCollection(n){const o=(0,M.hJ)(this.firestore,"uploader/"+n);return(0,M.$k)(o).pipe((0,Y.q)(1),(0,Z.K)(s=>(console.error(s),(0,G._)(()=>{const i=new Error(s);return i.timestamp=Date.now(),i}))),(0,E.U)(s=>s.map(i=>{const p=i.data();return Object.assign({},p)})))}uploadBlob(n){return this.storage.ref("folder-1").put(n)}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(M.gg),t.LFG(R.Q1))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),tt=(()=>{class e{constructor(n,o,s){this.store=n,this.ss=o,this.rs=s,this.filesUploadingAll$=this.store.select(_t),this.anyFilesUploading$=this.store.select(Et)}attachFile(n,o){this.store.dispatch(k({file:n,fileId:o}))}uploadFile(n,o){return this.ss.uploadBlob(n,o)}addPhotoUrl(n,o){return this.rs.addDocumentToCollection(n,o+"/photos")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.yh),t.LFG(q),t.LFG(Dt))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var D=y(7093),Bt=y(7423),et=y(5245),N=y(9808),wt=y(5899);let bt=(()=>{class e{constructor(){this.mode="indeterminate"}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["shared-loading-bar"]],inputs:{progress:"progress",mode:"mode"},decls:2,vars:3,consts:[[1,"parent"],[3,"mode","value","color"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"mat-progress-bar",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("mode",o.mode)("value",o.progress)("color",100===o.progress?"primary":"accent"))},directives:[wt.pW],styles:[".parent[_ngcontent-%COMP%]{height:100%}mat-progress-bar.mat-progress-bar[_ngcontent-%COMP%]{height:100%;border-radius:30px}"]}),e})();var Zt=y(7121),Nt=y(837);function jt(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"div",15)(2,"div"),t._uU(3),t.qZA()(),t.BQk()),2&e){const n=t.oxw(2);t.xp6(3),t.hij(" Uploading ( ",n.file.progress,"% ) ")}}function Rt(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"shared-loading-bar",16),t.BQk()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("progress",n.file.progress)("mode","determinate")}}function Ht(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"div",17),t._UZ(2,"img",18),t.qZA(),t.BQk()),2&e){const n=t.oxw(2);t.xp6(2),t.Q6J("src",n.imgPreview,t.LSH)}}function zt(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"a",19),t._uU(2,"Click here"),t.qZA(),t.BQk()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("href",n.file.downloadUrl,t.LSH)}}function Qt(e,a){1&e&&t._uU(0," Creating URL... ")}function Jt(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"div",3)(2,"div",4)(3,"div",5),t.YNc(4,jt,4,1,"ng-container",6),t.qZA(),t.TgZ(5,"div",7)(6,"div",8),t.YNc(7,Rt,2,2,"ng-container",0),t.qZA()(),t.YNc(8,Ht,3,1,"ng-container",6),t.TgZ(9,"div",9),t._UZ(10,"hr"),t.qZA(),t.TgZ(11,"div",10)(12,"div",11)(13,"div",12),t._uU(14," File Name: "),t.qZA(),t.TgZ(15,"div",13),t._uU(16),t.qZA()(),t.TgZ(17,"div",11)(18,"div",12),t._uU(19," File Size: "),t.qZA(),t.TgZ(20,"div",13),t._uU(21),t.ALo(22,"fileSizeDisplay"),t.qZA()(),t.TgZ(23,"div",11)(24,"div",12),t._uU(25," Date modified: "),t.qZA(),t.TgZ(26,"div"),t._uU(27),t.ALo(28,"dateDisplay"),t.qZA()(),t.TgZ(29,"div",11)(30,"div",12),t._uU(31," Download URL: "),t.qZA(),t.TgZ(32,"div"),t.YNc(33,zt,3,1,"ng-container",6),t.YNc(34,Qt,1,0,"ng-template",null,14,t.W1O),t.qZA()()()()(),t.BQk()),2&e){const n=t.MAs(35),o=t.oxw(),s=t.MAs(2),i=t.MAs(4);t.xp6(4),t.Q6J("ngIf",o.file.progress<100)("ngIfElse",s),t.xp6(3),t.Q6J("ngIf",o.file.progress),t.xp6(1),t.Q6J("ngIf",o.isImgType)("ngIfElse",i),t.xp6(8),t.hij(" ",o.file.fileName," "),t.xp6(5),t.hij(" ",t.lcZ(22,10,o.file.fileSize)," "),t.xp6(6),t.hij(" ",t.xi3(28,12,o.file.dateModified,"MDY")," "),t.xp6(6),t.Q6J("ngIf",o.file.downloadUrl)("ngIfElse",n)}}function Gt(e,a){1&e&&(t.TgZ(0,"div",15)(1,"div",20)(2,"mat-icon",21),t._uU(3,"check_circle"),t.qZA()(),t.TgZ(4,"div"),t._uU(5," Completed "),t.qZA()())}function Yt(e,a){1&e&&(t.TgZ(0,"div",17)(1,"mat-icon",22),t._uU(2," description "),t.qZA()())}const Kt=["image/jpeg","image/png","image/gif"];let $t=(()=>{class e{constructor(){this.isImgType=!1,this.reader=new FileReader}ngOnInit(){}ngOnChanges(n){var o,s,i;this.imgId!==n.file.currentValue.id&&(null===(o=this.file)||void 0===o?void 0:o.file)&&(this.isImgType=!!Kt.includes(this.file.file.type),this.reader.onload=p=>this.imgPreview=this.reader.result,this.reader.readAsDataURL(null===(s=this.file)||void 0===s?void 0:s.file)),this.imgId||(this.imgId=null===(i=this.file)||void 0===i?void 0:i.id)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-upload-item"]],inputs:{file:"file"},features:[t.TTD],decls:5,vars:1,consts:[[4,"ngIf"],["finished",""],["notImg",""],[1,"file-parent"],[1,"card"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px",1,"loading-status","poppins"],[4,"ngIf","ngIfElse"],["fxLayout","row","fxLayoutAlign","center center"],[1,"progress-parent"],[1,"w-100"],["fxLayout","column","fxLayoutAlign","start start","fxLayoutGap","10px",1,"w-100","poppins","info-parent"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","10px",1,"info-line"],[1,"label"],[1,"value"],["noUrl",""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px"],[3,"progress","mode"],[1,"image-parent"],[1,"preview-img",3,"src"],["download","hi",3,"href"],["fxLayout","column","fxLayoutAlign","center center"],[1,"done"],["fxLayout","row","fxLayoutAlign","center center",1,"file-icon"]],template:function(n,o){1&n&&(t.YNc(0,Jt,36,15,"ng-container",0),t.YNc(1,Gt,6,0,"ng-template",null,1,t.W1O),t.YNc(3,Yt,3,0,"ng-template",null,2,t.W1O)),2&n&&t.Q6J("ngIf",o.file)},directives:[N.O5,D.xw,D.Wh,D.SQ,bt,et.Hw],pipes:[Zt.nV,Nt.o],styles:[".file-parent[_ngcontent-%COMP%]{margin-top:30px}.file-parent[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-top-right-radius:25px;border-top-left-radius:25px;background-color:#ededf7}.file-parent[_ngcontent-%COMP%]   .loading-status[_ngcontent-%COMP%]{font-size:13px;height:2rem}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]{height:15rem;width:100%;overflow:hidden;text-align:center}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]   .preview-img[_ngcontent-%COMP%]{height:100%}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .progress-parent[_ngcontent-%COMP%]{height:10px;width:97%;margin-bottom:8px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]{padding:0 10px 10px;height:7rem;overflow:hidden;font-size:13px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .info-line[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}.file-parent[_ngcontent-%COMP%]   mat-icon.done[_ngcontent-%COMP%]{font-size:18px;color:#093;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.progress[_ngcontent-%COMP%]{font-size:18px;color:#b38600;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.file-icon[_ngcontent-%COMP%]{font-size:10rem;height:15rem;width:100%;color:#555}"]}),e})();const kt=["uploadInput"];function Wt(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"div",10),t._UZ(2,"app-upload-item",11),t.qZA(),t.BQk()),2&e){const n=a.$implicit;t.xp6(2),t.Q6J("file",n)}}function Xt(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"section",8),t.YNc(2,Wt,3,1,"ng-container",9),t.qZA(),t.BQk()),2&e){const n=a.ngIf,o=t.oxw();t.xp6(2),t.Q6J("ngForOf",n)("ngForTrackBy",o.trackById)}}const Vt=[{path:"",component:st,children:[{path:"",redirectTo:"upload",pathMatch:"full"},{path:"upload",component:(()=>{class e{constructor(n,o){this.fs=n,this.rs=o}ngOnInit(){}onFileUpload(){var n;const o=null===(n=this.uploadInput)||void 0===n?void 0:n.nativeElement;o&&o.click()}onFileInputClick(n){var o;const s=null===(o=n.target)||void 0===o?void 0:o.files;s&&Object.keys(s).forEach(p=>{this.fs.attachFile(s[p],(new Date).getTime()+p+"")})}trackById(n,o){return o.id}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(tt),t.Y36(q))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-main-all"]],viewQuery:function(n,o){if(1&n&&t.Gf(kt,5),2&n){let s;t.iGM(s=t.CRH())&&(o.uploadInput=s.first)}},decls:13,vars:3,consts:[[1,""],["type","file","multiple","",1,"upload-input",3,"change"],["uploadInput",""],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","15px",1,""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","15px",1,"quicksand","upload-action",3,"click"],[1,"text"],["mat-fab","","color","primary","aria-label","Upload files"],[4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","start center","fxLayoutGap","15px",1,"w-100"],[4,"ngFor","ngForOf","ngForTrackBy"],["fxFlex.gt-sm","23","fxFlex","100"],[3,"file"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"input",1,2),t.NdJ("change",function(i){return o.onFileInputClick(i)}),t.qZA()(),t.TgZ(3,"div",3)(4,"div",4),t.NdJ("click",function(){return o.onFileUpload()}),t.TgZ(5,"div",5),t._uU(6," Select items to upload "),t.qZA(),t.TgZ(7,"div")(8,"button",6)(9,"mat-icon"),t._uU(10,"file_upload"),t.qZA()()()(),t.YNc(11,Xt,3,2,"ng-container",7),t.ALo(12,"async"),t.qZA()),2&n&&(t.xp6(11),t.Q6J("ngIf",t.lcZ(12,1,o.fs.filesUploadingAll$)))},directives:[D.xw,D.Wh,D.SQ,Bt.lW,et.Hw,N.O5,N.sg,D.yH,$t],pipes:[N.Ov],styles:[".upload-action[_ngcontent-%COMP%]{border:1px solid #ccc;padding:5px 25px;border-radius:30px;background-color:#e6f2ff;cursor:pointer}.upload-action[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:20px}.upload-input[_ngcontent-%COMP%]{display:none;height:0px}"]}),e})(),data:{pageTitle:"Upload Files"}}]}];let qt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[H.Bz.forChild(Vt)],H.Bz]}),e})();var nt=y(5577),K=y(8746),ot=y(9300),te=y(7272),ee=y(9646),ne=y(3702);const oe=[(()=>{class e{constructor(n,o,s){this.actions$=n,this.us=o,this.as=s,this.attachFileForUpload$=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(k),(0,E.U)(i=>z({fileId:i.fileId,file:i.file})))),this.uploadFileStart$=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(z),(0,nt.z)(i=>{var p;const U=i.fileId,x=i.file,F=null!==(p=x.name)&&void 0!==p?p:"File-name-"+(new Date).getTime(),L=(new Date).getTime(),I=this.us.uploadFile(x,F);let T=[I.task.percentageChanges().pipe((0,E.U)(C=>({fileId:U,percent:C})),(0,K.x)(()=>{console.log("Upload done")})),I.ref.getDownloadURL().pipe((0,E.U)(C=>({fileId:U,url:C})),(0,K.x)(()=>{console.log("Fetch URL done")}))];return(0,te.z)(...T).pipe((0,E.U)(C=>J({fileId:U,fileSize:i.file.size,uploadDate:L,downloadUrl:C.url,progress:C.percent})),(0,Z.K)(C=>(console.error("Upload Error!"+C),(0,ee.of)(ht({errMsg:C})))),(0,K.x)(()=>{console.log("Upload and URL done")}))}))),this.uploadFileFinished$=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(J),(0,ot.h)(i=>!!i.downloadUrl),(0,E.U)(i=>Q({fileId:i.fileId,fileSize:i.fileSize,uploadDate:i.uploadDate,downloadUrl:i.downloadUrl})))),this.updateUserPhotoDatabaseAfterUploadSuccess$=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(Q),(0,E.U)(i=>(console.log(i,"updating now"),W({photoData:{id:i.fileId,dateUploaded:i.uploadDate,fileName:i.fileId,fileSize:i.fileSize,photoUrl:i.downloadUrl}}))))),this.updateUserPhotoDatabase$=(0,A.GW)(()=>this.actions$.pipe((0,A.l4)(W),(0,A.IC)(()=>this.as.currentUser$),(0,ot.h)(i=>{var p;return!!(null===(p=i[1])||void 0===p?void 0:p.email)}),(0,nt.z)(i=>{var p,U;const x=null!==(U=null===(p=i[1])||void 0===p?void 0:p.email)&&void 0!==U?U:"DEFAULT-USER",F=this.us.addPhotoUrl(i[0].photoData,x),I=F.id;return F.operationObs.then(T=>{const w=Object.assign(Object.assign({},i[0].photoData),{id:I});return yt({photoData:w})}).catch(T=>vt({errMsg:T}))})))}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(A.eX),t.LFG(tt),t.LFG(ne.e))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})()];let ie=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[],imports:[[at.n,it.I,rt.d,m.Aw.forFeature(X,Ft),A.sQ.forFeature(oe),R.TE,qt]]}),e})()}}]);