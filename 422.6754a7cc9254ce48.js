"use strict";(self.webpackChunkuploader=self.webpackChunkuploader||[]).push([[422],{422:(vt,K,h)=>{h.r(K),h.d(K,{MainModule:()=>ht});var Q=h(3271),C=h(6991),m=h(5620),ce=h(61),de=h(7462),ue=h(4987),N=h(3287),e=h(5e3);let pe=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main"]],decls:2,vars:0,consts:[[1,"container","mb-5","mt-3"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"router-outlet"),e.qZA())},directives:[N.lC],styles:[""]}),t})();var j=h(5698);const q=(0,m.PH)("[Upload/UI] attach a file",(0,m.Ky)()),X=(0,m.PH)("[Upload/UI] Remove all attached files"),W=(0,m.PH)("[Upload/API] Upload file start",(0,m.Ky)()),z=(0,m.PH)("[Upload/API] Upload file successful",(0,m.Ky)()),V=(0,m.PH)("[Upload/API] Upload file failed",(0,m.Ky)()),R=(0,m.PH)("[Upload/API] Upload file progress update",(0,m.Ky)()),J=(0,m.PH)("[Upload/API] Update new photo in user DB start",(0,m.Ky)()),ee=(0,m.PH)("[Upload/API] Update new photo in user DB successful",(0,m.Ky)()),te=(0,m.PH)("[Upload/API] Update new photo in user DB failed",(0,m.Ky)()),ne="uploadFiles";var u=(()=>{return(t=u||(u={}))[t.EntitiesOnly=0]="EntitiesOnly",t[t.Both=1]="Both",t[t.None=2]="None",u;var t})();function v(t){return function(n,o){const a={ids:[...o.ids],entities:Object.assign({},o.entities)},r=t(n,a);return r===u.Both?Object.assign({},o,a):r===u.EntitiesOnly?Object.assign(Object.assign({},o),{entities:a.entities}):o}}function L(t,i){const n=i(t);return(0,e.X6Q)()&&void 0===n&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",t,"The `selectId` implementation:",i.toString()),n}function oe(t){function i(g,c){const l=L(g,t);return l in c.entities?u.None:(c.ids.push(l),c.entities[l]=g,u.Both)}function n(g,c){let l=!1;for(const s of g)l=i(s,c)!==u.None||l;return l?u.Both:u.None}function a(g,c){const l=L(g,t);return l in c.entities?(c.entities[l]=g,u.EntitiesOnly):(c.ids.push(l),c.entities[l]=g,u.Both)}function x(g,c){const s=(g instanceof Array?g:c.ids.filter(d=>g(c.entities[d]))).filter(d=>d in c.entities).map(d=>delete c.entities[d]).length>0;return s&&(c.ids=c.ids.filter(d=>d in c.entities)),s?u.Both:u.None}function Z(g,c){return P([g],c)}function P(g,c){const l={};return(g=g.filter(d=>d.id in c.entities)).length>0?g.filter(f=>function F(g,c,l){const d=Object.assign({},l.entities[c.id],c.changes),f=L(d,t),y=f!==c.id;return y&&(g[c.id]=f,delete l.entities[c.id]),l.entities[f]=d,y}(l,f,c)).length>0?(c.ids=c.ids.map(f=>l[f]||f),u.Both):u.EntitiesOnly:u.None}function E(g,c){const l=[],s=[];for(const y of g){const O=L(y,t);O in c.entities?s.push({id:O,changes:y}):l.push(y)}const d=P(s,c),f=n(l,c);switch(!0){case f===u.None&&d===u.None:return u.None;case f===u.Both||d===u.Both:return u.Both;default:return u.EntitiesOnly}}return{removeAll:function M(g){return Object.assign({},g,{ids:[],entities:{}})},addOne:v(i),addMany:v(n),setAll:v(function o(g,c){return c.ids=[],c.entities={},n(g,c),u.Both}),setOne:v(a),setMany:v(function r(g,c){const l=g.map(s=>a(s,c));switch(!0){case l.some(s=>s===u.Both):return u.Both;case l.some(s=>s===u.EntitiesOnly):return u.EntitiesOnly;default:return u.None}}),updateOne:v(Z),updateMany:v(P),upsertOne:v(function _(g,c){return E([g],c)}),upsertMany:v(E),removeOne:v(function p(g,c){return x([g],c)}),removeMany:v(x),map:v(function b(g,c){return P(c.ids.reduce((d,f)=>{const y=g(c.entities[f]);return y!==c.entities[f]&&d.push({id:f,changes:y}),d},[]).filter(({id:d})=>d in c.entities),c)}),mapOne:v(function H({map:g,id:c},l){const s=l.entities[c];return s?Z({id:c,changes:g(s)},l):u.None})}}const T=function Pe(t={}){var i,n;const{selectId:o,sortComparer:a}={selectId:null!==(i=t.selectId)&&void 0!==i?i:M=>M.id,sortComparer:null!==(n=t.sortComparer)&&void 0!==n&&n},r=function Me(){return{getInitialState:function t(i={}){return Object.assign({ids:[],entities:{}},i)}}}(),p=function Ce(){return{getSelectors:function t(i){const n=p=>p.ids,o=p=>p.entities,a=(0,m.P1)(n,o,(p,x)=>p.map(M=>x[M])),r=(0,m.P1)(n,p=>p.length);return i?{selectIds:(0,m.P1)(i,n),selectEntities:(0,m.P1)(i,o),selectAll:(0,m.P1)(i,a),selectTotal:(0,m.P1)(i,r)}:{selectIds:n,selectEntities:o,selectAll:a,selectTotal:r}}}}(),x=a?function Ae(t,i){const{removeOne:n,removeMany:o,removeAll:a}=oe(t);function r(l,s){return p([l],s)}function p(l,s){const d=l.filter(f=>!(L(f,t)in s.entities));return 0===d.length?u.None:(c(d,s),u.Both)}function M(l,s){const d=L(l,t);return d in s.entities?(s.ids=s.ids.filter(f=>f!==d),c([l],s),u.Both):r(l,s)}function Z(l,s){return b([l],s)}function b(l,s){const d=[],f=l.filter(y=>function P(l,s,d){if(!(s.id in d.entities))return!1;const y=Object.assign({},d.entities[s.id],s.changes),O=L(y,t);return delete d.entities[s.id],l.push(y),O!==s.id}(d,y,s)).length>0;if(0===d.length)return u.None;{const y=s.ids,O=[];return s.ids=s.ids.filter((I,D)=>I in s.entities||(O.push(D),!1)),c(d,s),!f&&O.every(I=>s.ids[I]===y[I])?u.EntitiesOnly:u.Both}}function g(l,s){const d=[],f=[];for(const I of l){const D=L(I,t);D in s.entities?f.push({id:D,changes:I}):d.push(I)}const y=b(f,s),O=p(d,s);switch(!0){case O===u.None&&y===u.None:return u.None;case O===u.Both||y===u.Both:return u.Both;default:return u.EntitiesOnly}}function c(l,s){l.sort(i);const d=[];let f=0,y=0;for(;f<l.length&&y<s.ids.length;){const O=l[f],I=L(O,t),D=s.ids[y];i(O,s.entities[D])<=0?(d.push(I),f++):(d.push(D),y++)}s.ids=d.concat(f<l.length?l.slice(f).map(t):s.ids.slice(y)),l.forEach((O,I)=>{s.entities[t(O)]=O})}return{removeOne:n,removeMany:o,removeAll:a,addOne:v(r),updateOne:v(Z),upsertOne:v(function E(l,s){return g([l],s)}),setAll:v(function x(l,s){return s.entities={},s.ids=[],p(l,s),u.Both}),setOne:v(M),setMany:v(function F(l,s){const d=l.map(f=>M(f,s));switch(!0){case d.some(f=>f===u.Both):return u.Both;case d.some(f=>f===u.EntitiesOnly):return u.EntitiesOnly;default:return u.None}}),addMany:v(p),updateMany:v(b),upsertMany:v(g),map:v(function H(l,s){return b(s.ids.reduce((f,y)=>{const O=l(s.entities[y]);return O!==s.entities[y]&&f.push({id:y,changes:O}),f},[]),s)}),mapOne:v(function _({map:l,id:s},d){const f=d.entities[s];return f?Z({id:s,changes:l(f)},d):u.None})}}(o,a):oe(o);return Object.assign(Object.assign(Object.assign({selectId:o,sortComparer:a},r),p),x)}({selectId:function Te(t){return t.id},sortComparer:function Ie(t,i){return t.attachDate&&i.attachDate?t.attachDate<i.attachDate?1:-1:1}}),be=T.getInitialState({apiWorking:!1,filesUploadedAndUrlAddedToDb:[],errMsg:void 0,error:!1}),Le=(0,m.Lq)(be,(0,m.on)(X,t=>T.removeAll(Object.assign(Object.assign({},t),{apiWorking:!1,error:!1,errMsg:void 0,filesUploadedAndUrlAddedToDb:[]}))),(0,m.on)(W,(t,{file:i,fileId:n})=>{const o={attachDate:(new Date).getTime(),dateModified:i.lastModified,file:i,fileName:i.name,fileSize:i.size,id:n,completed:!1,progress:0,downloadUrl:void 0};return T.addOne(o,Object.assign(Object.assign({},t),{apiWorking:!0}))}),(0,m.on)(R,(t,{fileId:i,progress:n,downloadUrl:o})=>{var a,r;const p={id:i,changes:{progress:null!=n?n:null===(a=t.entities[i])||void 0===a?void 0:a.progress,downloadUrl:null!=o?o:null===(r=t.entities[i])||void 0===r?void 0:r.downloadUrl}};return T.updateOne(p,Object.assign(Object.assign({},t),{apiWorking:!0}))}),(0,m.on)(z,(t,{fileId:i})=>{const n={id:i,changes:{completed:!0,completedDate:(new Date).getTime()}};return T.updateOne(n,Object.assign(Object.assign({},t),{apiWorking:!1}))}),(0,m.on)(V,(t,{errMsg:i})=>Object.assign(Object.assign({},t),{apiWorking:!1,error:!0,errMsg:i})),(0,m.on)(J,(t,{photoData:i})=>T.updateOne({id:i.id,changes:{urlUploaded:!1}},Object.assign(Object.assign({},t),{apiWorking:!0}))),(0,m.on)(ee,(t,{photoData:i})=>{var n;const o={id:i.id,changes:{urlUploaded:!0}},a=[...null!==(n=t.filesUploadedAndUrlAddedToDb)&&void 0!==n?n:[]];return a.push(i),T.updateOne(o,Object.assign(Object.assign({},t),{apiWorking:!1,filesUploadedAndUrlAddedToDb:a}))}),(0,m.on)(te,(t,{errMsg:i})=>Object.assign(Object.assign({},t),{apiWorking:!1,error:!0,errMsg:i})));function we(t,i){return Le(t,i)}const S=(0,m.ZF)(ne),Fe=((0,m.P1)(S,T.getSelectors().selectIds),(0,m.P1)(S,T.getSelectors().selectEntities),(0,m.P1)(S,T.getSelectors().selectAll)),Ze=((0,m.P1)(S,T.getSelectors().selectTotal),(0,m.P1)(S,t=>t.apiWorking));var Ee=h(5439);let ie=(()=>{class t{constructor(n){this.storage=n}uploadBlob(n,o){const a="uploader-app/"+this.getCurrentTime()+"/"+o,r=this.storage.ref(a),p=r.put(n);return{ref:r,task:p}}getCurrentTime(){return Ee().format("MM-DD-YYYY")}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(Q.Q1))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var U=h(5265),Y=h(2843),w=h(4004),k=h(262);let Se=(()=>{class t{constructor(n,o){this.firestore=n,this.storage=o}createDocument(n,o){const a=(0,U.JU)(this.firestore,"uploader/"+o);return(0,U.pl)(a,n)}updateDocument(n){if(n){const o=(0,U.JU)(this.firestore,"uploader/");return(0,U.r7)(o,{amount:n})}return Promise.resolve()}addDocumentToCollection(n,o){const a=(0,U.JU)((0,U.hJ)(this.firestore,"uploader/"+o)),r=a.id,p=Object.assign(Object.assign({},n),{id:r});return{operationObs:(0,U.pl)(a,p),id:r}}getDocument(n){const o=(0,U.JU)(this.firestore,"uploader/"+n);return(0,U.KO)(o).pipe((0,j.q)(1),(0,w.U)(a=>a.data()),(0,k.K)(a=>(console.error(a),(0,Y._)(()=>{const r=new Error(a);return r.timestamp=Date.now(),r}))))}addEntryToCollection(n){const o=(0,U.JU)((0,U.hJ)(this.firestore,"uploader/")),a=o.id;return{operationObs:(0,U.pl)(o,{}),id:a}}getDataByCollectionName(n){const o=(0,U.hJ)(this.firestore,"uploader/");return(0,U.$k)(o).pipe((0,j.q)(1),(0,k.K)(a=>(console.error(a),(0,Y._)(()=>{const r=new Error(a);return r.timestamp=Date.now(),r}))),(0,w.U)(a=>a.map(r=>{const p=r.data();return Object.assign({id:r.id},p)})))}getCollection(n){const o=(0,U.hJ)(this.firestore,"uploader/"+n);return(0,U.$k)(o).pipe((0,j.q)(1),(0,k.K)(a=>(console.error(a),(0,Y._)(()=>{const r=new Error(a);return r.timestamp=Date.now(),r}))),(0,w.U)(a=>a.map(r=>{const p=r.data();return Object.assign({},p)})))}uploadBlob(n){return this.storage.ref("folder-1").put(n)}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(U.gg),e.LFG(Q.Q1))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),re=(()=>{class t{constructor(n,o,a){this.store=n,this.ss=o,this.rs=a,this.filesUploadingAll$=this.store.select(Fe),this.anyFilesUploading$=this.store.select(Ze)}attachFile(n,o){this.store.dispatch(q({file:n,fileId:o}))}cleanUpAttachedFiles(){this.store.dispatch(X())}uploadFile(n,o){return this.ss.uploadBlob(n,o)}addPhotoUrl(n,o){return this.rs.addDocumentToCollection(n,o+"/photos")}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(m.yh),e.LFG(ie),e.LFG(Se))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ae=h(3702),Be=h(3003),B=h(9808),A=h(7093),Ne=h(7423),G=h(5245),je=h(5899);let ke=(()=>{class t{constructor(){this.mode="indeterminate"}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["shared-loading-bar"]],inputs:{progress:"progress",mode:"mode"},decls:2,vars:3,consts:[[1,"parent"],[3,"mode","value","color"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"mat-progress-bar",1),e.qZA()),2&n&&(e.xp6(1),e.Q6J("mode",o.mode)("value",o.progress)("color",100===o.progress?"primary":"accent"))},directives:[je.pW],styles:[".parent[_ngcontent-%COMP%]{height:100%}mat-progress-bar.mat-progress-bar[_ngcontent-%COMP%]{height:100%;border-radius:30px}"]}),t})();var He=h(7121),Qe=h(837);function We(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",15)(2,"div"),e._uU(3),e.qZA()(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(3),e.hij(" Uploading ( ",n.file.progress,"% ) ")}}function ze(t,i){if(1&t&&(e.ynx(0),e._UZ(1,"shared-loading-bar",16),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("progress",n.file.progress)("mode","determinate")}}function Re(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",17),e._UZ(2,"img",18),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(2),e.Q6J("src",n.imgPreview,e.LSH)}}function Je(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"a",19),e._uU(2,"Click here"),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("href",n.file.downloadUrl,e.LSH)}}function Ye(t,i){1&t&&e._uU(0," Creating URL... ")}function Ge(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",3)(2,"div",4)(3,"div",5),e.YNc(4,We,4,1,"ng-container",6),e.qZA(),e.TgZ(5,"div",7)(6,"div",8),e.YNc(7,ze,2,2,"ng-container",0),e.qZA()(),e.YNc(8,Re,3,1,"ng-container",6),e.TgZ(9,"div",9),e._UZ(10,"hr"),e.qZA(),e.TgZ(11,"div",10)(12,"div",11)(13,"div",12),e._uU(14," File Name: "),e.qZA(),e.TgZ(15,"div",13),e._uU(16),e.qZA()(),e.TgZ(17,"div",11)(18,"div",12),e._uU(19," File Size: "),e.qZA(),e.TgZ(20,"div",13),e._uU(21),e.ALo(22,"fileSizeDisplay"),e.qZA()(),e.TgZ(23,"div",11)(24,"div",12),e._uU(25," Date modified: "),e.qZA(),e.TgZ(26,"div"),e._uU(27),e.ALo(28,"dateDisplay"),e.qZA()(),e.TgZ(29,"div",11)(30,"div",12),e._uU(31," Download URL: "),e.qZA(),e.TgZ(32,"div"),e.YNc(33,Je,3,1,"ng-container",6),e.YNc(34,Ye,1,0,"ng-template",null,14,e.W1O),e.qZA()()()()(),e.BQk()),2&t){const n=e.MAs(35),o=e.oxw(),a=e.MAs(2),r=e.MAs(4);e.xp6(4),e.Q6J("ngIf",o.file.progress<100)("ngIfElse",a),e.xp6(3),e.Q6J("ngIf",o.file.progress),e.xp6(1),e.Q6J("ngIf",o.isImgType)("ngIfElse",r),e.xp6(8),e.hij(" ",o.file.fileName," "),e.xp6(5),e.hij(" ",e.lcZ(22,10,o.file.fileSize)," "),e.xp6(6),e.hij(" ",e.xi3(28,12,o.file.dateModified,"MDY")," "),e.xp6(6),e.Q6J("ngIf",o.file.downloadUrl)("ngIfElse",n)}}function $e(t,i){1&t&&(e.TgZ(0,"div",15)(1,"div",20)(2,"mat-icon",21),e._uU(3,"check_circle"),e.qZA()(),e.TgZ(4,"div"),e._uU(5," Completed "),e.qZA()())}function Ke(t,i){1&t&&(e.TgZ(0,"div",17)(1,"mat-icon",22),e._uU(2," description "),e.qZA()())}const qe=["image/jpeg","image/png","image/gif"];let Xe=(()=>{class t{constructor(){this.isImgType=!1,this.reader=new FileReader}ngOnInit(){}ngOnChanges(n){var o,a,r;this.imgId!==n.file.currentValue.id&&(null===(o=this.file)||void 0===o?void 0:o.file)&&(this.isImgType=!!qe.includes(this.file.file.type),this.reader.onload=p=>this.imgPreview=this.reader.result,this.reader.readAsDataURL(null===(a=this.file)||void 0===a?void 0:a.file)),this.imgId||(this.imgId=null===(r=this.file)||void 0===r?void 0:r.id)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-upload-item"]],inputs:{file:"file"},features:[e.TTD],decls:5,vars:1,consts:[[4,"ngIf"],["finished",""],["notImg",""],[1,"file-parent"],[1,"card"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px",1,"loading-status","poppins"],[4,"ngIf","ngIfElse"],["fxLayout","row","fxLayoutAlign","center center"],[1,"progress-parent"],[1,"w-100"],["fxLayout","column","fxLayoutAlign","start start","fxLayoutGap","5px",1,"w-100","poppins","info-parent"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","10px",1,"info-line"],[1,"label"],[1,"value"],["noUrl",""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px"],[3,"progress","mode"],[1,"image-parent"],[1,"preview-img",3,"src"],["download","hi",3,"href"],["fxLayout","column","fxLayoutAlign","center center"],[1,"done"],["fxLayout","row","fxLayoutAlign","center center",1,"file-icon"]],template:function(n,o){1&n&&(e.YNc(0,Ge,36,15,"ng-container",0),e.YNc(1,$e,6,0,"ng-template",null,1,e.W1O),e.YNc(3,Ke,3,0,"ng-template",null,2,e.W1O)),2&n&&e.Q6J("ngIf",o.file)},directives:[B.O5,A.xw,A.Wh,A.SQ,ke,G.Hw],pipes:[He.nV,Qe.o],styles:[".file-parent[_ngcontent-%COMP%]{margin-top:30px}.file-parent[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-top-right-radius:25px;border-top-left-radius:25px;background-color:#ededf7}.file-parent[_ngcontent-%COMP%]   .loading-status[_ngcontent-%COMP%]{font-size:13px;height:2rem}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]{height:15rem;width:100%;overflow:hidden;text-align:center}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]   .preview-img[_ngcontent-%COMP%]{height:100%}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .progress-parent[_ngcontent-%COMP%]{height:10px;width:97%;margin-bottom:8px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]{padding:0 10px 10px;height:7rem;overflow:hidden;font-size:11px}.file-parent[_ngcontent-%COMP%]   .info-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .info-line[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}.file-parent[_ngcontent-%COMP%]   mat-icon.done[_ngcontent-%COMP%]{font-size:18px;color:#093;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.progress[_ngcontent-%COMP%]{font-size:18px;color:#b38600;text-align:center;height:100%}.file-parent[_ngcontent-%COMP%]   mat-icon.file-icon[_ngcontent-%COMP%]{font-size:10rem;height:15rem;width:100%;color:#555}"]}),t})();function Ve(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",2),e._uU(2),e.qZA(),e.BQk()),2&t){const n=e.oxw();e.xp6(2),e.hij(" Welcome back ",n.currentUser.email,", what are you uploading today? ")}}const et=function(){return["/","auth","signin"]};function tt(t,i){1&t&&(e.TgZ(0,"div",3)(1,"div",4),e._uU(2," Hello! "),e.qZA(),e.TgZ(3,"div",5)(4,"div"),e._UZ(5,"img",6),e.qZA(),e.TgZ(6,"div",7)(7,"mat-icon",8),e._uU(8,"face"),e.qZA()()(),e.TgZ(9,"div",9)(10,"a",10),e._uU(11,"Create a Uploader account to get started."),e.qZA()()()),2&t&&(e.xp6(10),e.Q6J("routerLink",e.DdM(1,et)))}let nt=(()=>{class t{constructor(){this.fileList=[]}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main-welcome"]],inputs:{currentUser:"currentUser",fileList:"fileList"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noUser",""],[1,"poppins","user","gray-text"],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","20px",1,"no-user"],[1,"poppins","main"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px"],["src","assets/img/uploader.png","alt","logo",1,"logo-img"],["fxLayout","row","fxLayoutAlign","center center"],[1,"welcome-icon"],[1,"poppins"],[3,"routerLink"]],template:function(n,o){if(1&n&&(e.YNc(0,Ve,3,1,"ng-container",0),e.YNc(1,tt,12,2,"ng-template",null,1,e.W1O)),2&n){const a=e.MAs(2);e.Q6J("ngIf",o.currentUser)("ngIfElse",a)}},directives:[B.O5,A.xw,A.Wh,A.SQ,G.Hw,N.yS],styles:[".no-user[_ngcontent-%COMP%]   .logo-img[_ngcontent-%COMP%]{height:4rem}.no-user[_ngcontent-%COMP%]   .welcome-icon[_ngcontent-%COMP%]{font-size:4.7rem;height:4.7rem;width:4.7rem;color:#5f5dbb}.no-user[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]{font-size:32px;color:#5f5dbb}.no-user[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#5f5dbb}.user[_ngcontent-%COMP%]{font-size:20px}"]}),t})();var ot=h(7579);let it=(()=>{class t{constructor(){this.wholePage=!1,this.loading=!0,this.logoShakeState=!1,this.compDest$=new ot.x}ngOnChanges(n){this.parentClass=this.wholePage?"whole-page loading-container":"container loading-container mt-5"}ngOnInit(){}ngOnDestroy(){this.compDest$.next(null),this.compDest$.complete()}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-shared-loading"]],inputs:{wholePage:"wholePage",message:"message"},features:[e.TTD],decls:12,vars:3,consts:[["fxLayout","column","fxLayoutAlign","center center",1,"w-100"],[1,""],[1,"loading-logo"],["src","assets/img/uploader.png","alt","logo",1,"logo-img","d-inline-block"],[1,"loading-parent"],[1,"lds-facebook"],[1,"secfont"]],template:function(n,o){1&n&&(e.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"div",2),e._UZ(4,"img",3),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5),e._UZ(7,"div")(8,"div")(9,"div"),e.qZA()(),e.TgZ(10,"div",6),e._uU(11),e.qZA()()()),2&n&&(e.Tol(o.parentClass),e.xp6(11),e.hij(" Loading ",o.message," ... "))},directives:[A.xw,A.Wh],styles:[".loading-logo[_ngcontent-%COMP%]{height:3rem}.loading-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.loading-parent[_ngcontent-%COMP%]{justify-content:center;align-items:center}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.whole-page[_ngcontent-%COMP%]{position:fixed;width:100%}.lds-facebook[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;position:absolute;left:8px;width:16px;background:#007bff;animation:lds-facebook 1.2s cubic-bezier(0,.5,.5,1) infinite}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){left:8px;animation-delay:-.24s}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){left:32px;animation-delay:-.12s}.lds-facebook[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(3){left:56px;animation-delay:0}@keyframes lds-facebook{0%{top:8px;height:64px}50%,to{top:24px;height:32px}}"]}),t})();const rt=["uploadInput"];function at(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",15),e._UZ(2,"app-upload-item",16),e.qZA(),e.BQk()),2&t){const n=i.$implicit;e.xp6(2),e.Q6J("file",n)}}function st(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",11)(2,"div",12),e._uU(3," File Uploading .. "),e.qZA(),e.TgZ(4,"section",13),e.YNc(5,at,3,1,"ng-container",14),e.qZA()(),e.BQk()),2&t){const n=e.oxw().ngIf,o=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",n)("ngForTrackBy",o.trackById)}}function lt(t,i){if(1&t&&(e.ynx(0),e.YNc(1,st,6,2,"ng-container",9),e.BQk()),2&t){const n=i.ngIf;e.xp6(1),e.Q6J("ngIf",n.length>0)}}function ct(t,i){if(1&t){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",2)(2,"input",3,4),e.NdJ("change",function(a){return e.CHM(n),e.oxw().onFileInputClick(a)}),e.qZA()(),e.TgZ(4,"div",5)(5,"div",6),e.NdJ("click",function(){return e.CHM(n),e.oxw().onFileUpload()}),e.TgZ(6,"div",7),e._uU(7," Select items to upload "),e.qZA(),e.TgZ(8,"div")(9,"button",8),e.ALo(10,"async"),e.TgZ(11,"mat-icon"),e._uU(12,"file_upload"),e.qZA()()()(),e.YNc(13,lt,2,1,"ng-container",9),e.ALo(14,"async"),e._UZ(15,"app-main-welcome",10),e.ALo(16,"async"),e.qZA(),e.BQk()}if(2&t){const n=e.oxw();e.xp6(9),e.Q6J("disabled",!e.lcZ(10,3,n.as.currentUser$)),e.xp6(4),e.Q6J("ngIf",e.lcZ(14,5,n.fs.filesUploadingAll$)),e.xp6(2),e.Q6J("currentUser",e.lcZ(16,7,n.as.currentUser$))}}function dt(t,i){1&t&&(e.TgZ(0,"div",11),e._UZ(1,"app-shared-loading"),e.qZA())}const ut=[{path:"",component:pe,children:[{path:"",redirectTo:"upload",pathMatch:"full"},{path:"upload",component:(()=>{class t{constructor(n,o,a,r){this.fs=n,this.rs=o,this.as=a,this.ts=r}ngOnInit(){}onFileUpload(){var n;const o=null===(n=this.uploadInput)||void 0===n?void 0:n.nativeElement;o&&this.as.currentUser$.pipe((0,j.q)(1)).subscribe(a=>{a?o.click():this.ts.openSingletonToast("warning","You are not logged in.")})}onFileInputClick(n){var o;const a=null===(o=n.target)||void 0===o?void 0:o.files;a&&(this.fs.cleanUpAttachedFiles(),Object.keys(a).forEach(p=>{this.fs.attachFile(a[p],(new Date).getTime()+p+"")}))}trackById(n,o){return o.id}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(re),e.Y36(ie),e.Y36(ae.e),e.Y36(Be.q))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-main-all"]],viewQuery:function(n,o){if(1&n&&e.Gf(rt,5),2&n){let a;e.iGM(a=e.CRH())&&(o.uploadInput=a.first)}},decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],[1,""],["type","file","multiple","",1,"upload-input",3,"change"],["uploadInput",""],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","45px",1,"w-100"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","15px",1,"quicksand","upload-action",3,"click"],[1,"text"],["mat-fab","","color","primary","aria-label","Upload files",3,"disabled"],[4,"ngIf"],[3,"currentUser"],[1,"w-100"],["fxLayout","row","fxLayoutAlign","center center",1,"poppins","uploading-title"],["fxLayout","row wrap","fxLayoutAlign","start center","fxLayoutGap","15px",1,"w-100"],[4,"ngFor","ngForOf","ngForTrackBy"],["fxFlex.gt-sm","23","fxFlex","100"],[3,"file"]],template:function(n,o){if(1&n&&(e.YNc(0,ct,17,9,"ng-container",0),e.ALo(1,"async"),e.YNc(2,dt,2,0,"ng-template",null,1,e.W1O)),2&n){const a=e.MAs(3);e.Q6J("ngIf",!1===e.lcZ(1,2,o.as.apiLoading$))("ngIfElse",a)}},directives:[B.O5,A.xw,A.Wh,A.SQ,Ne.lW,G.Hw,B.sg,A.yH,Xe,nt,it],pipes:[B.Ov],styles:[".upload-action[_ngcontent-%COMP%]{border:1px solid #ccc;padding:5px 25px;border-radius:30px;background-color:#e6f2ff;cursor:pointer}.upload-action[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:20px;color:#5f5dbb}.upload-input[_ngcontent-%COMP%]{display:none;height:0px}.uploading-title[_ngcontent-%COMP%]{color:#888}"]}),t})(),data:{pageTitle:"Upload Files"}}]}];let pt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[N.Bz.forChild(ut)],N.Bz]}),t})();var se=h(5577),$=h(8746),le=h(9300),ft=h(7272),gt=h(9646);const mt=[(()=>{class t{constructor(n,o,a){this.actions$=n,this.us=o,this.as=a,this.attachFileForUpload$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(q),(0,w.U)(r=>W({fileId:r.fileId,file:r.file})))),this.uploadFileStart$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(W),(0,se.z)(r=>{var p;const x=r.fileId,M=r.file,F=null!==(p=M.name)&&void 0!==p?p:"File-name-"+(new Date).getTime(),Z=(new Date).getTime(),P=this.us.uploadFile(M,F);let b=[P.task.percentageChanges().pipe((0,w.U)(_=>({fileId:x,percent:_})),(0,$.x)(()=>{console.log("Upload done")})),P.ref.getDownloadURL().pipe((0,w.U)(_=>({fileId:x,url:_})),(0,$.x)(()=>{console.log("Fetch URL done")}))];return(0,ft.z)(...b).pipe((0,w.U)(_=>{var E;const g=null!==(E=_.percent)&&void 0!==E?E:_.url?100:_.percent;return R({fileId:x,fileSize:r.file.size,uploadDate:Z,downloadUrl:_.url,progress:g})}),(0,k.K)(_=>(console.error("Upload Error!"+_),(0,gt.of)(V({errMsg:_})))),(0,$.x)(()=>{console.log("Upload and URL done")}))}))),this.uploadFileFinished$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(R),(0,le.h)(r=>!(!r.downloadUrl||100!==r.progress)),(0,w.U)(r=>z({fileId:r.fileId,fileSize:r.fileSize,uploadDate:r.uploadDate,downloadUrl:r.downloadUrl})))),this.updateUserPhotoDatabaseAfterUploadSuccess$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(z),(0,w.U)(r=>J({photoData:{id:r.fileId,dateUploaded:r.uploadDate,fileName:r.fileId,fileSize:r.fileSize,photoUrl:r.downloadUrl}})))),this.updateUserPhotoDatabase$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(J),(0,C.IC)(()=>this.as.currentUser$),(0,le.h)(r=>{var p;return!!(null===(p=r[1])||void 0===p?void 0:p.email)}),(0,se.z)(r=>{var p;const x=null===(p=r[1])||void 0===p?void 0:p.email,F=this.us.addPhotoUrl(r[0].photoData,x).operationObs,Z=r[0].photoData.id;return F.then(P=>{const b=Object.assign(Object.assign({},r[0].photoData),{id:Z});return ee({photoData:b})}).catch(P=>te({errMsg:P}))})))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(C.eX),e.LFG(re),e.LFG(ae.e))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})()];let ht=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[],imports:[[ue.n,ce.I,de.d,m.Aw.forFeature(ne,we),C.sQ.forFeature(mt),Q.TE,pt]]}),t})()}}]);