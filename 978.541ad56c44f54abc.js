"use strict";(self.webpackChunkuploader=self.webpackChunkuploader||[]).push([[978],{4978:(Bt,Z,m)=>{m.r(Z),m.d(Z,{MainModule:()=>bt});var U=m(6642),y=m(5620),J=m(9808),Q=m(9764),W=m(2599),d=m(5e3);let Y=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({providers:[],imports:[[J.ez,Q.o9,W.p]]}),t})();var X=m(851),k=m(8064),L=m(5215);let V=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-main"]],decls:2,vars:0,consts:[[1,"container","mb-5","mt-3"]],template:function(i,a){1&i&&(d.TgZ(0,"div",0),d._UZ(1,"router-outlet"),d.qZA())},directives:[L.lC],styles:[""]}),t})();const G=(0,y.PH)("[Upload/UI] attach a file",(0,y.Ky)()),x=(0,y.PH)("[Upload/API] Upload file start",(0,y.Ky)()),R=(0,y.PH)("[Upload/API] Upload file successful",(0,y.Ky)()),N=((0,y.PH)("[Upload/API] Upload file failed",(0,y.Ky)()),(0,y.PH)("[Upload/API] Upload file progress update",(0,y.Ky)())),z="uploadFiles";var l=(()=>{return(t=l||(l={}))[t.EntitiesOnly=0]="EntitiesOnly",t[t.Both=1]="Both",t[t.None=2]="None",l;var t})();function h(t){return function(i,a){const p={ids:[...a.ids],entities:Object.assign({},a.entities)},M=t(i,p);return M===l.Both?Object.assign({},a,p):M===l.EntitiesOnly?Object.assign(Object.assign({},a),{entities:p.entities}):a}}function E(t,r){const i=r(t);return(0,d.X6Q)()&&void 0===i&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",t,"The `selectId` implementation:",r.toString()),i}function $(t){function r(u,o){const n=E(u,t);return n in o.entities?l.None:(o.ids.push(n),o.entities[n]=u,l.Both)}function i(u,o){let n=!1;for(const e of u)n=r(e,o)!==l.None||n;return n?l.Both:l.None}function p(u,o){const n=E(u,t);return n in o.entities?(o.entities[n]=u,l.EntitiesOnly):(o.ids.push(n),o.entities[n]=u,l.Both)}function F(u,o){const e=(u instanceof Array?u:o.ids.filter(s=>u(o.entities[s]))).filter(s=>s in o.entities).map(s=>delete o.entities[s]).length>0;return e&&(o.ids=o.ids.filter(s=>s in o.entities)),e?l.Both:l.None}function C(u,o){return S([u],o)}function S(u,o){const n={};return(u=u.filter(s=>s.id in o.entities)).length>0?u.filter(c=>function w(u,o,n){const s=Object.assign({},n.entities[o.id],o.changes),c=E(s,t),f=c!==o.id;return f&&(u[o.id]=c,delete n.entities[o.id]),n.entities[c]=s,f}(n,c,o)).length>0?(o.ids=o.ids.map(c=>n[c]||c),l.Both):l.EntitiesOnly:l.None}function T(u,o){const n=[],e=[];for(const f of u){const O=E(f,t);O in o.entities?e.push({id:O,changes:f}):n.push(f)}const s=S(e,o),c=i(n,o);switch(!0){case c===l.None&&s===l.None:return l.None;case c===l.Both||s===l.Both:return l.Both;default:return l.EntitiesOnly}}return{removeAll:function I(u){return Object.assign({},u,{ids:[],entities:{}})},addOne:h(r),addMany:h(i),setAll:h(function a(u,o){return o.ids=[],o.entities={},i(u,o),l.Both}),setOne:h(p),setMany:h(function M(u,o){const n=u.map(e=>p(e,o));switch(!0){case n.some(e=>e===l.Both):return l.Both;case n.some(e=>e===l.EntitiesOnly):return l.EntitiesOnly;default:return l.None}}),updateOne:h(C),updateMany:h(S),upsertOne:h(function K(u,o){return T([u],o)}),upsertMany:h(T),removeOne:h(function g(u,o){return F([u],o)}),removeMany:h(F),map:h(function B(u,o){return S(o.ids.reduce((s,c)=>{const f=u(o.entities[c]);return f!==o.entities[c]&&s.push({id:c,changes:f}),s},[]).filter(({id:s})=>s in o.entities),o)}),mapOne:h(function D({map:u,id:o},n){const e=n.entities[o];return e?C({id:o,changes:u(e)},n):l.None})}}const A=function lt(t={}){var r,i;const{selectId:a,sortComparer:p}={selectId:null!==(r=t.selectId)&&void 0!==r?r:I=>I.id,sortComparer:null!==(i=t.sortComparer)&&void 0!==i&&i},M=function ot(){return{getInitialState:function t(r={}){return Object.assign({ids:[],entities:{}},r)}}}(),g=function st(){return{getSelectors:function t(r){const i=g=>g.ids,a=g=>g.entities,p=(0,y.P1)(i,a,(g,F)=>g.map(I=>F[I])),M=(0,y.P1)(i,g=>g.length);return r?{selectIds:(0,y.P1)(r,i),selectEntities:(0,y.P1)(r,a),selectAll:(0,y.P1)(r,p),selectTotal:(0,y.P1)(r,M)}:{selectIds:i,selectEntities:a,selectAll:p,selectTotal:M}}}}(),F=p?function rt(t,r){const{removeOne:i,removeMany:a,removeAll:p}=$(t);function M(n,e){return g([n],e)}function g(n,e){const s=n.filter(c=>!(E(c,t)in e.entities));return 0===s.length?l.None:(o(s,e),l.Both)}function I(n,e){const s=E(n,t);return s in e.entities?(e.ids=e.ids.filter(c=>c!==s),o([n],e),l.Both):M(n,e)}function C(n,e){return B([n],e)}function B(n,e){const s=[],c=n.filter(f=>function S(n,e,s){if(!(e.id in s.entities))return!1;const f=Object.assign({},s.entities[e.id],e.changes),O=E(f,t);return delete s.entities[e.id],n.push(f),O!==e.id}(s,f,e)).length>0;if(0===s.length)return l.None;{const f=e.ids,O=[];return e.ids=e.ids.filter((v,b)=>v in e.entities||(O.push(b),!1)),o(s,e),!c&&O.every(v=>e.ids[v]===f[v])?l.EntitiesOnly:l.Both}}function u(n,e){const s=[],c=[];for(const v of n){const b=E(v,t);b in e.entities?c.push({id:b,changes:v}):s.push(v)}const f=B(c,e),O=g(s,e);switch(!0){case O===l.None&&f===l.None:return l.None;case O===l.Both||f===l.Both:return l.Both;default:return l.EntitiesOnly}}function o(n,e){n.sort(r);const s=[];let c=0,f=0;for(;c<n.length&&f<e.ids.length;){const O=n[c],v=E(O,t),b=e.ids[f];r(O,e.entities[b])<=0?(s.push(v),c++):(s.push(b),f++)}e.ids=s.concat(c<n.length?n.slice(c).map(t):e.ids.slice(f)),n.forEach((O,v)=>{e.entities[t(O)]=O})}return{removeOne:i,removeMany:a,removeAll:p,addOne:h(M),updateOne:h(C),upsertOne:h(function T(n,e){return u([n],e)}),setAll:h(function F(n,e){return e.entities={},e.ids=[],g(n,e),l.Both}),setOne:h(I),setMany:h(function w(n,e){const s=n.map(c=>I(c,e));switch(!0){case s.some(c=>c===l.Both):return l.Both;case s.some(c=>c===l.EntitiesOnly):return l.EntitiesOnly;default:return l.None}}),addMany:h(g),updateMany:h(B),upsertMany:h(u),map:h(function D(n,e){return B(e.ids.reduce((c,f)=>{const O=n(e.entities[f]);return O!==e.entities[f]&&c.push({id:f,changes:O}),c},[]),e)}),mapOne:h(function K({map:n,id:e},s){const c=s.entities[e];return c?C({id:e,changes:n(c)},s):l.None})}}(a,p):$(a);return Object.assign(Object.assign(Object.assign({selectId:a,sortComparer:p},M),g),F)}({selectId:function at(t){return t.id},sortComparer:function ct(t,r){return t.attachDate&&r.attachDate?t.attachDate<r.attachDate?1:-1:1}}),ut=A.getInitialState({uploading:!1}),dt=(0,y.Lq)(ut,(0,y.on)(x,(t,{file:r,fileId:i})=>{const a={attachDate:(new Date).getTime(),dateModified:r.lastModified,file:r,fileName:r.name,fileSize:r.size,id:i,completed:!1,progress:0};return A.addOne(a,Object.assign(Object.assign({},t),{uploading:!0}))}),(0,y.on)(N,(t,{fileId:r,progress:i})=>A.updateOne({id:r,changes:{progress:i}},Object.assign(Object.assign({},t),{uploading:!0}))),(0,y.on)(R,(t,{fileId:r})=>{const i={id:r,changes:{completed:!0,completedDate:(new Date).getTime()}};return A.updateOne(i,Object.assign(Object.assign({},t),{uploading:!1}))}));function pt(t,r){return dt(t,r)}const P=(0,y.ZF)(z),ft=((0,y.P1)(P,A.getSelectors().selectIds),(0,y.P1)(P,A.getSelectors().selectEntities),(0,y.P1)(P,A.getSelectors().selectAll)),yt=((0,y.P1)(P,A.getSelectors().selectTotal),(0,y.P1)(P,t=>t.uploading));let ht=(()=>{class t{constructor(i){this.store=i,this.filesUploadingAll$=this.store.select(ft),this.anyFilesUploading$=this.store.select(yt)}attachFile(i,a){this.store.dispatch(G({file:i,fileId:a}))}}return t.\u0275fac=function(i){return new(i||t)(d.LFG(y.yh))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var j=m(7093),gt=m(7423),mt=m(5245);const Mt=["uploadInput"],Ot=[{path:"",component:V,children:[{path:"",redirectTo:"upload",pathMatch:"full"},{path:"upload",component:(()=>{class t{constructor(i){this.fs=i}ngOnInit(){}onFileUpload(){var i;const a=null===(i=this.uploadInput)||void 0===i?void 0:i.nativeElement;a&&a.click()}onFileInputClick(i){var a;const p=null===(a=i.target)||void 0===a?void 0:a.files;p&&Object.keys(p).forEach(g=>{this.fs.attachFile(p[g],(new Date).getTime()+g+"")})}}return t.\u0275fac=function(i){return new(i||t)(d.Y36(ht))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-main-all"]],viewQuery:function(i,a){if(1&i&&d.Gf(Mt,5),2&i){let p;d.iGM(p=d.CRH())&&(a.uploadInput=p.first)}},decls:11,vars:0,consts:[[1,""],["type","file","multiple","",1,"upload-input",3,"change"],["uploadInput",""],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","15px",1,""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","15px",1,"quicksand","upload-action",3,"click"],[1,"text"],["mat-fab","","color","primary","aria-label","Upload files"]],template:function(i,a){1&i&&(d.TgZ(0,"div",0)(1,"input",1,2),d.NdJ("change",function(M){return a.onFileInputClick(M)}),d.qZA()(),d.TgZ(3,"div",3)(4,"div",4),d.NdJ("click",function(){return a.onFileUpload()}),d.TgZ(5,"div",5),d._uU(6," Select items to upload "),d.qZA(),d.TgZ(7,"div")(8,"button",6)(9,"mat-icon"),d._uU(10,"file_upload"),d.qZA()()()()())},directives:[j.xw,j.Wh,j.SQ,gt.lW,mt.Hw],styles:[".upload-action[_ngcontent-%COMP%]{border:1px solid #ccc;padding:5px 25px;border-radius:30px;background-color:#e6f2ff;cursor:pointer}.upload-action[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:20px}.upload-input[_ngcontent-%COMP%]{display:none;height:0px}"]}),t})(),data:{pageTitle:"Upload Files"}}]}];let vt=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[L.Bz.forChild(Ot)],L.Bz]}),t})();var H=m(4004),Ft=m(5577),Et=m(5698),Ut=m(9300),At=m(2805);const It=[(()=>{class t{constructor(i){this.actions$=i,this.attachFileForUpload$=(0,U.GW)(()=>this.actions$.pipe((0,U.l4)(G),(0,H.U)(a=>{const p=a.file,M=a.fileId;return console.log(M),x({fileId:M,file:p})})),{dispatch:!0}),this.uploadFileStart$=(0,U.GW)(()=>this.actions$.pipe((0,U.l4)(x),(0,Ft.z)(a=>{const p=a.fileId;return(0,At.H)(0,500).pipe((0,Et.q)(10),(0,H.U)(g=>N({fileId:p,progress:10*(g+1)})))}))),this.uploadFileFinished$=(0,U.GW)(()=>this.actions$.pipe((0,U.l4)(N),(0,Ut.h)(a=>100===a.progress),(0,H.U)(a=>R({fileId:a.fileId}))))}}return t.\u0275fac=function(i){return new(i||t)(d.LFG(U.eX))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac}),t})()];let bt=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({providers:[],imports:[[k.n,Y,X.d,y.Aw.forFeature(z,pt),U.sQ.forFeature(It),vt]]}),t})()}}]);