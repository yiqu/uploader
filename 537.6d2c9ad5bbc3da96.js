"use strict";(self.webpackChunkuploader=self.webpackChunkuploader||[]).push([[537],{2537:(we,_,M)=>{M.r(_),M.d(_,{MainModule:()=>Ze});var U=M(6642),g=M(5620),b=M(9808),$=M(2155),k=M(8282),t=M(5e3);let z=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[],imports:[[b.ez,$.o9,k.p]]}),e})();var Y=M(1929),W=M(2861),Z=M(5215);let X=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-main"]],decls:2,vars:0,consts:[[1,"container","mb-5","mt-3"]],template:function(n,s){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"router-outlet"),t.qZA())},directives:[Z.lC],styles:[""]}),e})();const J=(0,g.PH)("[Upload/UI] attach a file",(0,g.Ky)()),N=(0,g.PH)("[Upload/API] Upload file start",(0,g.Ky)()),G=(0,g.PH)("[Upload/API] Upload file successful",(0,g.Ky)()),w=((0,g.PH)("[Upload/API] Upload file failed",(0,g.Ky)()),(0,g.PH)("[Upload/API] Upload file progress update",(0,g.Ky)())),R="uploadFiles";var c=(()=>{return(e=c||(c={}))[e.EntitiesOnly=0]="EntitiesOnly",e[e.Both=1]="Both",e[e.None=2]="None",c;var e})();function m(e){return function(n,s){const p={ids:[...s.ids],entities:Object.assign({},s.entities)},h=e(n,p);return h===c.Both?Object.assign({},s,p):h===c.EntitiesOnly?Object.assign(Object.assign({},s),{entities:p.entities}):s}}function I(e,o){const n=o(e);return(0,t.X6Q)()&&void 0===n&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",e,"The `selectId` implementation:",o.toString()),n}function K(e){function o(d,a){const r=I(d,e);return r in a.entities?c.None:(a.ids.push(r),a.entities[r]=d,c.Both)}function n(d,a){let r=!1;for(const i of d)r=o(i,a)!==c.None||r;return r?c.Both:c.None}function p(d,a){const r=I(d,e);return r in a.entities?(a.entities[r]=d,c.EntitiesOnly):(a.ids.push(r),a.entities[r]=d,c.Both)}function F(d,a){const i=(d instanceof Array?d:a.ids.filter(l=>d(a.entities[l]))).filter(l=>l in a.entities).map(l=>delete a.entities[l]).length>0;return i&&(a.ids=a.ids.filter(l=>l in a.entities)),i?c.Both:c.None}function L(d,a){return T([d],a)}function T(d,a){const r={};return(d=d.filter(l=>l.id in a.entities)).length>0?d.filter(u=>function H(d,a,r){const l=Object.assign({},r.entities[a.id],a.changes),u=I(l,e),f=u!==a.id;return f&&(d[a.id]=u,delete r.entities[a.id]),r.entities[u]=l,f}(r,u,a)).length>0?(a.ids=a.ids.map(u=>r[u]||u),c.Both):c.EntitiesOnly:c.None}function S(d,a){const r=[],i=[];for(const f of d){const v=I(f,e);v in a.entities?i.push({id:v,changes:f}):r.push(f)}const l=T(i,a),u=n(r,a);switch(!0){case u===c.None&&l===c.None:return c.None;case u===c.Both||l===c.Both:return c.Both;default:return c.EntitiesOnly}}return{removeAll:function x(d){return Object.assign({},d,{ids:[],entities:{}})},addOne:m(o),addMany:m(n),setAll:m(function s(d,a){return a.ids=[],a.entities={},n(d,a),c.Both}),setOne:m(p),setMany:m(function h(d,a){const r=d.map(i=>p(i,a));switch(!0){case r.some(i=>i===c.Both):return c.Both;case r.some(i=>i===c.EntitiesOnly):return c.EntitiesOnly;default:return c.None}}),updateOne:m(L),updateMany:m(T),upsertOne:m(function D(d,a){return S([d],a)}),upsertMany:m(S),removeOne:m(function y(d,a){return F([d],a)}),removeMany:m(F),map:m(function P(d,a){return T(a.ids.reduce((l,u)=>{const f=d(a.entities[u]);return f!==a.entities[u]&&l.push({id:u,changes:f}),l},[]).filter(({id:l})=>l in a.entities),a)}),mapOne:m(function Q({map:d,id:a},r){const i=r.entities[a];return i?L({id:a,changes:d(i)},r):c.None})}}const A=function ae(e={}){var o,n;const{selectId:s,sortComparer:p}={selectId:null!==(o=e.selectId)&&void 0!==o?o:x=>x.id,sortComparer:null!==(n=e.sortComparer)&&void 0!==n&&n},h=function oe(){return{getInitialState:function e(o={}){return Object.assign({ids:[],entities:{}},o)}}}(),y=function re(){return{getSelectors:function e(o){const n=y=>y.ids,s=y=>y.entities,p=(0,g.P1)(n,s,(y,F)=>y.map(x=>F[x])),h=(0,g.P1)(n,y=>y.length);return o?{selectIds:(0,g.P1)(o,n),selectEntities:(0,g.P1)(o,s),selectAll:(0,g.P1)(o,p),selectTotal:(0,g.P1)(o,h)}:{selectIds:n,selectEntities:s,selectAll:p,selectTotal:h}}}}(),F=p?function se(e,o){const{removeOne:n,removeMany:s,removeAll:p}=K(e);function h(r,i){return y([r],i)}function y(r,i){const l=r.filter(u=>!(I(u,e)in i.entities));return 0===l.length?c.None:(a(l,i),c.Both)}function x(r,i){const l=I(r,e);return l in i.entities?(i.ids=i.ids.filter(u=>u!==l),a([r],i),c.Both):h(r,i)}function L(r,i){return P([r],i)}function P(r,i){const l=[],u=r.filter(f=>function T(r,i,l){if(!(i.id in l.entities))return!1;const f=Object.assign({},l.entities[i.id],i.changes),v=I(f,e);return delete l.entities[i.id],r.push(f),v!==i.id}(l,f,i)).length>0;if(0===l.length)return c.None;{const f=i.ids,v=[];return i.ids=i.ids.filter((O,C)=>O in i.entities||(v.push(C),!1)),a(l,i),!u&&v.every(O=>i.ids[O]===f[O])?c.EntitiesOnly:c.Both}}function d(r,i){const l=[],u=[];for(const O of r){const C=I(O,e);C in i.entities?u.push({id:C,changes:O}):l.push(O)}const f=P(u,i),v=y(l,i);switch(!0){case v===c.None&&f===c.None:return c.None;case v===c.Both||f===c.Both:return c.Both;default:return c.EntitiesOnly}}function a(r,i){r.sort(o);const l=[];let u=0,f=0;for(;u<r.length&&f<i.ids.length;){const v=r[u],O=I(v,e),C=i.ids[f];o(v,i.entities[C])<=0?(l.push(O),u++):(l.push(C),f++)}i.ids=l.concat(u<r.length?r.slice(u).map(e):i.ids.slice(f)),r.forEach((v,O)=>{i.entities[e(v)]=v})}return{removeOne:n,removeMany:s,removeAll:p,addOne:m(h),updateOne:m(L),upsertOne:m(function S(r,i){return d([r],i)}),setAll:m(function F(r,i){return i.entities={},i.ids=[],y(r,i),c.Both}),setOne:m(x),setMany:m(function H(r,i){const l=r.map(u=>x(u,i));switch(!0){case l.some(u=>u===c.Both):return c.Both;case l.some(u=>u===c.EntitiesOnly):return c.EntitiesOnly;default:return c.None}}),addMany:m(y),updateMany:m(P),upsertMany:m(d),map:m(function Q(r,i){return P(i.ids.reduce((u,f)=>{const v=r(i.entities[f]);return v!==i.entities[f]&&u.push({id:f,changes:v}),u},[]),i)}),mapOne:m(function D({map:r,id:i},l){const u=l.entities[i];return u?L({id:i,changes:r(u)},l):c.None})}}(s,p):K(s);return Object.assign(Object.assign(Object.assign({selectId:s,sortComparer:p},h),y),F)}({selectId:function le(e){return e.id},sortComparer:function ce(e,o){return e.attachDate&&o.attachDate?e.attachDate<o.attachDate?1:-1:1}}),ue=A.getInitialState({uploading:!1}),de=(0,g.Lq)(ue,(0,g.on)(N,(e,{file:o,fileId:n})=>{const s={attachDate:(new Date).getTime(),dateModified:o.lastModified,file:o,fileName:o.name,fileSize:o.size,id:n,completed:!1,progress:0};return A.addOne(s,Object.assign(Object.assign({},e),{uploading:!0}))}),(0,g.on)(w,(e,{fileId:o,progress:n})=>A.updateOne({id:o,changes:{progress:n}},Object.assign(Object.assign({},e),{uploading:!0}))),(0,g.on)(G,(e,{fileId:o})=>{const n={id:o,changes:{completed:!0,completedDate:(new Date).getTime()}};return A.updateOne(n,Object.assign(Object.assign({},e),{uploading:!1}))}));function pe(e,o){return de(e,o)}const B=(0,g.ZF)(R),fe=((0,g.P1)(B,A.getSelectors().selectIds),(0,g.P1)(B,A.getSelectors().selectEntities),(0,g.P1)(B,A.getSelectors().selectAll)),ge=((0,g.P1)(B,A.getSelectors().selectTotal),(0,g.P1)(B,e=>e.uploading));let me=(()=>{class e{constructor(n){this.store=n,this.filesUploadingAll$=this.store.select(fe),this.anyFilesUploading$=this.store.select(ge)}attachFile(n,s){this.store.dispatch(J({file:n,fileId:s}))}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(g.yh))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var E=M(7093),he=M(7423),ye=M(5245),Me=M(5899);let ve=(()=>{class e{constructor(){this.progress=0,this.mode="indeterminate"}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["shared-loading-bar"]],inputs:{progress:"progress",mode:"mode"},decls:2,vars:3,consts:[[1,"parent"],[3,"mode","value","color"]],template:function(n,s){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"mat-progress-bar",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("mode",s.mode)("value",s.progress)("color",100===s.progress?"primary":"accent"))},directives:[Me.pW],styles:[".parent[_ngcontent-%COMP%]{height:100%}mat-progress-bar.mat-progress-bar[_ngcontent-%COMP%]{height:100%}"]}),e})();var Oe=M(837);function Fe(e,o){if(1&e&&(t.ynx(0),t.TgZ(1,"div",7),t._UZ(2,"shared-loading-bar",8),t.qZA(),t.BQk()),2&e){const n=t.oxw(2);t.xp6(2),t.Q6J("progress",n.file.progress)("mode","determinate")}}function Ie(e,o){if(1&e&&(t.ynx(0),t.TgZ(1,"div",1)(2,"div",2),t.YNc(3,Fe,3,2,"ng-container",0),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.qZA(),t.TgZ(6,"div",5)(7,"div",6),t._uU(8),t.qZA(),t.TgZ(9,"div",6),t._uU(10),t.qZA(),t.TgZ(11,"div",6),t._uU(12),t.ALo(13,"dateDisplay"),t.qZA()()()(),t.BQk()),2&e){const n=t.oxw();t.xp6(3),t.Q6J("ngIf",!0),t.xp6(2),t.Q6J("src",n.imgPreview,t.LSH),t.xp6(3),t.hij(" ",n.file.fileName," "),t.xp6(2),t.hij(" ",n.file.fileSize," "),t.xp6(2),t.hij(" ",t.xi3(13,5,n.file.dateModified,"MDY")," ")}}let Ue=(()=>{class e{constructor(){this.reader=new FileReader}ngOnInit(){}ngOnChanges(n){var s,p,h;this.imgId!==n.file.currentValue.id&&(null===(s=this.file)||void 0===s?void 0:s.file)&&(this.reader.onload=y=>this.imgPreview=this.reader.result,this.reader.readAsDataURL(null===(p=this.file)||void 0===p?void 0:p.file)),this.imgId||(this.imgId=null===(h=this.file)||void 0===h?void 0:h.id)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-upload-item"]],inputs:{file:"file"},features:[t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[1,"file-parent"],[1,"card"],[1,"image-parent"],[1,"preview-img",3,"src"],["fxLayout","column","fxLayoutAlign","center center","fxLayoutGap","10px",1,"w-100"],[1,""],[1,"progress-parent"],[3,"progress","mode"]],template:function(n,s){1&n&&t.YNc(0,Ie,14,8,"ng-container",0),2&n&&t.Q6J("ngIf",s.file)},directives:[b.O5,ve,E.xw,E.Wh,E.SQ],pipes:[Oe.o],styles:[".file-parent[_ngcontent-%COMP%]{margin-top:30px}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]{height:15rem;width:15rem;overflow:hidden;background-color:#eee}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]   .preview-img[_ngcontent-%COMP%]{height:100%}.file-parent[_ngcontent-%COMP%]   .image-parent[_ngcontent-%COMP%]:hover{overflow:auto}.file-parent[_ngcontent-%COMP%]   .progress-parent[_ngcontent-%COMP%]{height:10px}"]}),e})();const Ae=["uploadInput"];function xe(e,o){if(1&e&&(t.ynx(0),t.TgZ(1,"div"),t._UZ(2,"app-upload-item",10),t.qZA(),t.BQk()),2&e){const n=o.$implicit;t.xp6(2),t.Q6J("file",n)}}function Ce(e,o){if(1&e&&(t.ynx(0),t.TgZ(1,"section",8),t.YNc(2,xe,3,1,"ng-container",9),t.qZA(),t.BQk()),2&e){const n=o.ngIf,s=t.oxw();t.xp6(2),t.Q6J("ngForOf",n)("ngForTrackBy",s.trackById)}}const Ee=[{path:"",component:X,children:[{path:"",redirectTo:"upload",pathMatch:"full"},{path:"upload",component:(()=>{class e{constructor(n){this.fs=n}ngOnInit(){}onFileUpload(){var n;const s=null===(n=this.uploadInput)||void 0===n?void 0:n.nativeElement;s&&s.click()}onFileInputClick(n){var s;const p=null===(s=n.target)||void 0===s?void 0:s.files;p&&Object.keys(p).forEach(y=>{this.fs.attachFile(p[y],(new Date).getTime()+y+"")})}trackById(n,s){return s.id}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(me))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-main-all"]],viewQuery:function(n,s){if(1&n&&t.Gf(Ae,5),2&n){let p;t.iGM(p=t.CRH())&&(s.uploadInput=p.first)}},decls:13,vars:3,consts:[[1,""],["type","file","multiple","",1,"upload-input",3,"change"],["uploadInput",""],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","15px",1,""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","15px",1,"quicksand","upload-action",3,"click"],[1,"text"],["mat-fab","","color","primary","aria-label","Upload files"],[4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","start center","fxLayoutGap","15px",1,"w-100"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"file"]],template:function(n,s){1&n&&(t.TgZ(0,"div",0)(1,"input",1,2),t.NdJ("change",function(h){return s.onFileInputClick(h)}),t.qZA()(),t.TgZ(3,"div",3)(4,"div",4),t.NdJ("click",function(){return s.onFileUpload()}),t.TgZ(5,"div",5),t._uU(6," Select items to upload "),t.qZA(),t.TgZ(7,"div")(8,"button",6)(9,"mat-icon"),t._uU(10,"file_upload"),t.qZA()()()(),t.YNc(11,Ce,3,2,"ng-container",7),t.ALo(12,"async"),t.qZA()),2&n&&(t.xp6(11),t.Q6J("ngIf",t.lcZ(12,1,s.fs.filesUploadingAll$)))},directives:[E.xw,E.Wh,E.SQ,he.lW,ye.Hw,b.O5,b.sg,Ue],pipes:[b.Ov],styles:[".upload-action[_ngcontent-%COMP%]{border:1px solid #ccc;padding:5px 25px;border-radius:30px;background-color:#e6f2ff;cursor:pointer}.upload-action[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:20px}.upload-input[_ngcontent-%COMP%]{display:none;height:0px}"]}),e})(),data:{pageTitle:"Upload Files"}}]}];let Te=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[Z.Bz.forChild(Ee)],Z.Bz]}),e})();var j=M(4004),Pe=M(5577),be=M(5698),Be=M(9300),Le=M(2805);const Se=[(()=>{class e{constructor(n){this.actions$=n,this.attachFileForUpload$=(0,U.GW)(()=>this.actions$.pipe((0,U.l4)(J),(0,j.U)(s=>{const p=s.file,h=s.fileId;return console.log(h),N({fileId:h,file:p})})),{dispatch:!0}),this.uploadFileStart$=(0,U.GW)(()=>this.actions$.pipe((0,U.l4)(N),(0,Pe.z)(s=>{const p=s.fileId;return(0,Le.H)(0,500).pipe((0,be.q)(10),(0,j.U)(y=>w({fileId:p,progress:10*(y+1)})))}))),this.uploadFileFinished$=(0,U.GW)(()=>this.actions$.pipe((0,U.l4)(w),(0,Be.h)(s=>100===s.progress),(0,j.U)(s=>G({fileId:s.fileId}))))}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(U.eX))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})()];let Ze=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[],imports:[[W.n,z,Y.d,g.Aw.forFeature(R,pe),U.sQ.forFeature(Se),Te]]}),e})()}}]);